app.controller("HomeController",["$rootScope","$scope","$location","$window","FlashService","MetaService","$modal",function(t,r,e,a,o,n,s){var i=this;t.metaservice=n,t.metaservice.set(),t.savedPreference=a.localStorage.getItem("healthyfling_preference"),"locked"==t.savedPreference&&(t.search.country=a.localStorage.getItem("healthyfling_preference_country")||"Country",t.search.state=a.localStorage.getItem("healthyfling_preference_state")||"State",t.search.region=a.localStorage.getItem("healthyfling_preference_region")||"Region",t.search.category=a.localStorage.getItem("healthyfling_preference_category")||"Category"),i.country=t.search.country||"Country",i.state=t.search.state||"State",i.region=t.search.region||"Region",i.category=t.search.category||"Category",r.countries=t.countryList,r.states=t.stateList,r.regions=t.regionList,r.savedPreference="locked"==t.savedPreference,i.savedPreference="locked"==t.savedPreference,r.regions&&-1==r.regions.indexOf("Region")&&r.regions.unshift("Region"),r.categories=t.categoryList,r.changeListInCtrl=function(e){if(""!=e&&null!=e&&"State"!=e&&"Provinces"!=e){t.regionList=t.masterList[e],r.regions=t.regionList,r.regions.unshift("Region");var a=r.regions;r.regions=a.filter(function(e,t){return a.indexOf(e)==t})}else"United States"!=i.country&&"Canada"!=i.country||(r.regions=["Region"])},r.changeStateListInCtrl=function(e){if(""!=e&&null!=e&&"Country"!=e)if(t.masterList=t.masterListAll[e],t.stateList=Object.keys(t.masterListAll[e]),r.states=t.stateList,"United States"!=e&&"Canada"!=e){t.regionList=t.masterList.State,r.regions=t.regionList,r.regions.unshift("Region");var a=r.regions;r.regions=a.filter(function(e,t){return a.indexOf(e)==t})}else"Canada"==e&&(i.state="Provinces");else t.stateList=["State"],r.states=t.stateList},i.post=function(){i.dataLoading=!0,e.path("/post")},i.pages=function(){i.dataLoading=!0,e.path("/pages")},i.login=function(){t.modalInstance=s.open({templateUrl:"app-view/login/LoginView.html"})},i.logout=function(){i.dataLoading=!0,a.localStorage.removeItem("token"),e.path("/"),window.location.reload()},i.lockPreference=function(){a.localStorage.setItem("healthyfling_preference","locked"),a.localStorage.setItem("healthyfling_preference_country",this.country),a.localStorage.setItem("healthyfling_preference_state",this.state),a.localStorage.setItem("healthyfling_preference_region",this.region),a.localStorage.setItem("healthyfling_preference_category",this.category),t.savedPreference=!0,i.savedPreference=!0,r.savedPreference="locked",o.Success("Search preference saved for easier browsing.")},i.unlockPreference=function(){a.localStorage.setItem("healthyfling_preference","unlocked"),i.country=t.search.country="Country",i.state=t.search.state="State",i.region=t.search.region="Region",i.category=t.search.category="Category",t.savedPreference=!1,i.savedPreference=!1,r.savedPreference="unlocked",o.Success("Search preference has been deleted.")},i.search=function(){t.loading=!0,t.search.country=this.country,t.search.state=this.state,t.search.region=this.region,t.search.category=this.category,i.dataLoading=!0,e.path("/search")}}]),app.controller("MediaVideoController",["$rootScope","$scope","$location","HttpService","$http","$route","FlashService","$document","$modal","$window","$routeParams","MetaService",function(o,r,n,a,s,e,i,t,c,l,g,d){var h=this;o.visitedSearchPage&&(o.loading=!0),r.likePost=function(e){if(!o.isLoggedIn)return alert("You need to be logged in!");window.localStorage.getItem(e+"video")||(window.localStorage.setItem(e+"video",!0),a.LikePostVideo(e).then(function(e){r.currentPost.data.videoLike=r.currentPost.data.videoLike+1}))},r.dislikePost=function(e){if(!o.isLoggedIn)return alert("You need to be logged in!");window.localStorage.getItem(e+"video")||(window.localStorage.setItem(e+"video",!0),a.DislikePostVideo(e).then(function(e){r.currentPost.data.videoDislike=r.currentPost.data.videoDislike+1}))},r.replyNotified=!1,r.showShareButtons=!1,r.showEmbedButtons=!1,r.replyNotifiedEmail="",r.embed="",r.commentembed="",r.comments=[],r.commentsMainImage=[],r.replyMainImage=[],o.savedPreference=l.localStorage.getItem("healthyfling_preference"),"locked"==o.savedPreference&&(o.search.country=l.localStorage.getItem("healthyfling_preference_country")||"Country",o.search.state=l.localStorage.getItem("healthyfling_preference_state")||"State",o.search.region=l.localStorage.getItem("healthyfling_preference_region")||"Region",o.search.category=l.localStorage.getItem("healthyfling_preference_category")||"Category"),h.country=o.search.country||"Country",h.state=o.search.state||"State",h.region=o.search.region||"Region",h.category=o.search.category||"Category",r.countries=o.countryList,r.states=o.stateList,r.regions=o.regionList||["REGION"],r.regions&&-1==r.regions.indexOf("Region")&&r.regions.unshift("Region"),r.categories=o.categoryList,r.savedPreference="locked"==o.savedPreference,h.savedPreference="locked"==o.savedPreference,r.changeListInCtrl=function(e){if(""!=e&&null!=e&&"State"!=e&&"Provinces"!=e){o.masterList=o.masterListAll[h.country],o.regionList=o.masterList[e],r.regions=o.regionList,r.regions.unshift("Region");var a=r.regions;r.regions=a.filter(function(e,t){return a.indexOf(e)==t})}else"United States"!=h.country&&"Canada"!=h.country||(r.regions=["Region"])},r.changeStateListInCtrl=function(e){if(""!=e&&null!=e&&"Country"!=e)if(o.masterList=o.masterListAll[e],o.stateList=Object.keys(o.masterListAll[e]),r.states=o.stateList,"United States"!=e&&"Canada"!=e){o.regionList=o.masterList.State,r.regions=o.regionList,r.regions.unshift("Region");var a=r.regions;r.regions=a.filter(function(e,t){return a.indexOf(e)==t})}else"Canada"==e&&(h.state="Provinces");else o.stateList=["State"],r.states=o.stateList},h.lockPreference=function(){l.localStorage.setItem("healthyfling_preference","locked"),l.localStorage.setItem("healthyfling_preference_country",h.country),l.localStorage.setItem("healthyfling_preference_state",h.state),l.localStorage.setItem("healthyfling_preference_region",h.region),l.localStorage.setItem("healthyfling_preference_category",h.category),o.savedPreference=!0,h.savedPreference=!0,r.savedPreference="locked",i.Success("Search preference saved for easier browsing.")},h.unlockPreference=function(){l.localStorage.setItem("healthyfling_preference","unlocked"),h.country=o.search.country="Country",h.state=o.search.state="State",h.region=o.search.region="Region",h.category=o.search.category="Category",o.savedPreference=!1,h.savedPreference=!1,r.savedPreference="unlocked",i.Success("Search preference has been deleted.")},o.imageList=[];var u=n.path().split("/"),m=u[u.length-1];r.id=m,r.currentPath=n.absUrl(),r.toggleShareButton=function(){r.showShareButtons&&1==r.showShareButtons?r.showShareButtons=!1:r.showShareButtons=!0},r.initController=function(){s.get("/data_country.json").success(function(e){o.masterListAll=e}),o.is_flagged=!1,h.country=o.search.country,h.state=o.search.state,h.region=o.search.region,h.category=o.search.category,r.comments=[];var e=n.path().split("/"),t=e[e.length-1];r.id=t,o.visitedSearchPage&&(o.loading=!0),r.mainImage={secure_url:"https://www.healthyfling.com/processed/default-52adc3dc03639885e8aa93763e29868269dd3b9dad4689f140c0175b4f945922.png"},a.GetAPagePost(g.id,g.postId).then(function(e){if(r.is_edit=!1,"200"==e.status&&e.data._id){o.currentPost.data=e.data,o.metaservice=d,o.metaservice.set(e.data.title,e.data.body,!!(e.data.files.length&&e.data.files[0]&&e.data.files[0].secure_url)&&e.data.files[0].secure_url);var t=n.search();t&&"true"==t.success?i.Success("Your post is now Live."):t&&"true"==t.edit?r.is_edit=!0:-1<n.url().indexOf("msg=true")&&i.Success("You have successfully replied to this post, you may or may not get a response from this poster."),h.country=e.data.country||"United States",o.masterList=o.masterListAll[h.country],o.regionList=o.masterList[e.data.state],r.regions=o.regionList,h.state=e.data.state,h.region=e.data.region,h.category=e.data.category,r.title=o.currentPost.data.title,o.pageTitle=r.title,r.post_id=o.currentPost.data._id,r.message=o.currentPost.data.body,r.message=r.message.replace(/[\r\n]/g,"<br/>"),r.age=o.currentPost.data.age,r.region=o.currentPost.data.region,r.location=o.currentPost.data.location,r.sender1=o.currentPost.data.email,r.country=o.currentPost.data.country||"United States",r.state=o.currentPost.data.state,r.category=o.currentPost.data.category,r.created=o.currentPost.data.created,r.expires=new Date(o.currentPost.data.created),r.expires.setDate(r.expires.getDate()+8),r.files=o.currentPost.data.files,r.status=o.currentPost.data.status,r.haircolor=o.currentPost.data.haircolor,r.city=o.currentPost.data.city,r.zip=o.currentPost.data.zip,r.height=o.currentPost.data.height,r.ethnicity=o.currentPost.data.ethnicity,r.orientation=o.currentPost.data.orientation,r.bodytype=o.currentPost.data.bodytype,r.eyecolor=o.currentPost.data.eyecolor,r.mstatus=o.currentPost.data.mstatus,r.gender=o.currentPost.data.gender,r.bodyhair=o.currentPost.data.bodyhair,r.hivstatus=o.currentPost.data.hivstatus,r.weight=o.currentPost.data.weight,r.mage=o.currentPost.data.mage,r.anonymouscomment=o.currentPost.data.anonymouscomment||"disabled",r.embed=o.currentPost.data.embed?o.currentPost.data.embed.replace("xxx=","src=").replace("yyyy=","href="):"",r.embedDescription=o.currentPost.data.embedDescription||"",r.share=o.currentPost.data.share||"disabled",o.loading=!1,-1<r.embed.indexOf("<iframe")?r.iframe=!0:(r.iframe=!1,-1<r.embed.indexOf("youtube.com")&&(r.embed="https://www.youtube.com/embed/"+r.embed.slice(r.embed.indexOf("v=")+2,r.embed.length)))}else o.loading=!1,h.dataLoading=!1,n.path("/expired")})},h.post=function(){n.path("/post")},h.pages=function(){h.dataLoading=!0,n.path("/pages")},h.login=function(){o.modalInstance=c.open({templateUrl:"app-view/login/LoginView.html"})},h.logout=function(){h.dataLoading=!0,l.localStorage.removeItem("token"),n.path("/"),window.location.reload()},h.search=function(){o.loading=!0,o.search.country=this.country,o.search.state=this.state,o.search.region=this.region,o.search.category=this.category,n.path("/search")},h.searchFilter=function(e,t,a,r){"Country"==e&&"State"==t&&"Region"==a||(o.loading=!0,o.search.country=e,o.search.state=t,o.search.region=a,o.search.category=r,n.path("/search"))},r.toggleShareButton=function(){r.showShareButtons&&1==r.showShareButtons?r.showShareButtons=!1:r.showShareButtons=!0},r.openModal_flag=function(){o.modalInstance=c.open({templateUrl:"app-view/flag/FlagView.html"})},r.stopLoader=function(){o.loadingImage=!1},r.closeModal=function(){o.modalInstance.close()}}]),app.controller("MediaPhotoController",["$rootScope","$scope","$location","HttpService","$http","$route","FlashService","$document","$modal","$window","$routeParams","MetaService",function(o,r,n,a,s,e,t,i,c,l,g,d){var h=this;o.visitedSearchPage&&(o.loading=!0),r.likePost=function(e){if(!o.isLoggedIn)return alert("You need to be logged in!");window.localStorage.getItem(e)||(window.localStorage.setItem(e,!0),a.LikePostPhoto(e).then(function(e){r.photoObject.like=r.photoObject.like+1}))},r.dislikePost=function(e){if(!o.isLoggedIn)return alert("You need to be logged in!");window.localStorage.getItem(e)||(window.localStorage.setItem(e,!0),a.DislikePostPhoto(e).then(function(e){r.photoObject.dislike=r.photoObject.dislike+1}))},r.replyNotified=!1,r.showShareButtons=!1,r.showEmbedButtons=!1,r.replyNotifiedEmail="",r.embed="",r.commentembed="",r.comments=[],r.commentsMainImage=[],r.replyMainImage=[],o.savedPreference=l.localStorage.getItem("healthyfling_preference"),"locked"==o.savedPreference&&(o.search.country=l.localStorage.getItem("healthyfling_preference_country")||"Country",o.search.state=l.localStorage.getItem("healthyfling_preference_state")||"State",o.search.region=l.localStorage.getItem("healthyfling_preference_region")||"Region",o.search.category=l.localStorage.getItem("healthyfling_preference_category")||"Category"),h.country=o.search.country||"Country",h.state=o.search.state||"State",h.region=o.search.region||"Region",h.category=o.search.category||"Category",r.countries=o.countryList,r.states=o.stateList,r.regions=o.regionList||["REGION"],r.regions&&-1==r.regions.indexOf("Region")&&r.regions.unshift("Region"),r.categories=o.categoryList,r.savedPreference="locked"==o.savedPreference,h.savedPreference="locked"==o.savedPreference,r.changeListInCtrl=function(e){if(""!=e&&null!=e&&"State"!=e&&"Provinces"!=e){o.masterList=o.masterListAll[h.country],o.regionList=o.masterList[e],r.regions=o.regionList,r.regions.unshift("Region");var a=r.regions;r.regions=a.filter(function(e,t){return a.indexOf(e)==t})}else"United States"!=h.country&&"Canada"!=h.country||(r.regions=["Region"])},r.changeStateListInCtrl=function(e){if(""!=e&&null!=e&&"Country"!=e)if(o.masterList=o.masterListAll[e],o.stateList=Object.keys(o.masterListAll[e]),r.states=o.stateList,"United States"!=e&&"Canada"!=e){o.regionList=o.masterList.State,r.regions=o.regionList,r.regions.unshift("Region");var a=r.regions;r.regions=a.filter(function(e,t){return a.indexOf(e)==t})}else"Canada"==e&&(h.state="Provinces");else o.stateList=["State"],r.states=o.stateList},h.lockPreference=function(){l.localStorage.setItem("healthyfling_preference","locked"),l.localStorage.setItem("healthyfling_preference_country",h.country),l.localStorage.setItem("healthyfling_preference_state",h.state),l.localStorage.setItem("healthyfling_preference_region",h.region),l.localStorage.setItem("healthyfling_preference_category",h.category),o.savedPreference=!0,h.savedPreference=!0,r.savedPreference="locked",t.Success("Search preference saved for easier browsing.")},h.unlockPreference=function(){l.localStorage.setItem("healthyfling_preference","unlocked"),h.country=o.search.country="Country",h.state=o.search.state="State",h.region=o.search.region="Region",h.category=o.search.category="Category",o.savedPreference=!1,h.savedPreference=!1,r.savedPreference="unlocked",t.Success("Search preference has been deleted.")},o.imageList=[],r.changeMainImage=function(e,t,a){a?(r.city&&(r.cityURL="https://www.google.com/maps/embed/v1/place?q="+r.city+"&key=AIzaSyCS-3gM8t4h2fR3XGawtaX8TYCC4PYEwlw"),r.zip&&(r.zipURL="https://www.google.com/maps/embed/v1/place?q="+r.zip+"&key=AIzaSyCS-3gM8t4h2fR3XGawtaX8TYCC4PYEwlw"),r.showMap=!0,r.showVideo=!1):(0==t?(r.showMap=!1,r.showMap=!1,r.showVideo=!1):(r.showVideo=!0,r.showMap=!1,-1<r.embed.indexOf("<iframe")?r.iframe=!0:(r.iframe=!1,-1<r.embed.indexOf("youtube.com")&&(r.embed="https://www.youtube.com/embed/"+r.embed.slice(r.embed.indexOf("v=")+2,r.embed.length)))),r.mainImage=e)},r.changeCommentsMainImage=function(e,t){r.commentsMainImage[t]=e},r.changeReplyMainImage=function(e,t,a){r.replyMainImage[t][a]=e};var u=n.path().split("/"),m=u[u.length-1];r.id=m,r.currentPath=n.absUrl(),r.toggleShareButton=function(){r.showShareButtons&&1==r.showShareButtons?r.showShareButtons=!1:r.showShareButtons=!0},r.initController=function(){s.get("/data_country.json").success(function(e){o.masterListAll=e}),o.is_flagged=!1,h.country=o.search.country,h.state=o.search.state,h.region=o.search.region,h.category=o.search.category,r.comments=[];var e=n.path().split("/"),t=e[e.length-1];r.id=t,o.visitedSearchPage&&(o.loading=!0),r.mainImage={secure_url:"https://www.healthyfling.com/processed/default-52adc3dc03639885e8aa93763e29868269dd3b9dad4689f140c0175b4f945922.png"},a.GetPostByPhoto(g.photoId).then(function(e){r.is_edit=!1,"200"==e.status&&e.data._id?(o.currentPost.data=e.data,e.data.files.map(function(e){e._id===g.photoId&&(r.photoObject=e)}),o.metaservice=d,o.metaservice.set(e.data.title,e.data.body,!!(e.data.files.length&&e.data.files[0]&&e.data.files[0].secure_url)&&e.data.files[0].secure_url),h.country=e.data.country||"United States",o.masterList=o.masterListAll[h.country],o.regionList=o.masterList[e.data.state],r.regions=o.regionList,h.state=e.data.state,h.region=e.data.region,h.category=e.data.category,r.title=o.currentPost.data.title,o.pageTitle=r.title,r.post_id=o.currentPost.data._id,r.message=o.currentPost.data.body,r.message=r.message.replace(/[\r\n]/g,"<br/>"),r.age=o.currentPost.data.age,r.region=o.currentPost.data.region,r.location=o.currentPost.data.location,r.sender1=o.currentPost.data.email,r.country=o.currentPost.data.country||"United States",r.state=o.currentPost.data.state,r.category=o.currentPost.data.category,r.created=o.currentPost.data.created,r.expires=new Date(o.currentPost.data.created),r.expires.setDate(r.expires.getDate()+8),r.files=o.currentPost.data.files,r.status=o.currentPost.data.status,r.haircolor=o.currentPost.data.haircolor,r.city=o.currentPost.data.city,r.zip=o.currentPost.data.zip,r.height=o.currentPost.data.height,r.ethnicity=o.currentPost.data.ethnicity,r.orientation=o.currentPost.data.orientation,r.bodytype=o.currentPost.data.bodytype,r.eyecolor=o.currentPost.data.eyecolor,r.mstatus=o.currentPost.data.mstatus,r.gender=o.currentPost.data.gender,r.bodyhair=o.currentPost.data.bodyhair,r.hivstatus=o.currentPost.data.hivstatus,r.weight=o.currentPost.data.weight,r.mage=o.currentPost.data.mage,r.anonymouscomment=o.currentPost.data.anonymouscomment||"disabled",r.embed=o.currentPost.data.embed?o.currentPost.data.embed.replace("xxx=","src=").replace("yyyy=","href="):"",r.embedDescription=o.currentPost.data.embedDescription||"",r.share=o.currentPost.data.share||"disabled",o.loading=!1):(o.loading=!1,h.dataLoading=!1,n.path("/expired"))})},o.reloadPost=function(){h.state=o.currentPost.data.body},h.post=function(){n.path("/post")},h.pages=function(){h.dataLoading=!0,n.path("/pages")},h.login=function(){o.modalInstance=c.open({templateUrl:"app-view/login/LoginView.html"})},h.logout=function(){h.dataLoading=!0,l.localStorage.removeItem("token"),n.path("/"),window.location.reload()},h.search=function(){o.loading=!0,o.search.country=this.country,o.search.state=this.state,o.search.region=this.region,o.search.category=this.category,n.path("/search")},h.searchFilter=function(e,t,a,r){"Country"==e&&"State"==t&&"Region"==a||(o.loading=!0,o.search.country=e,o.search.state=t,o.search.region=a,o.search.category=r,n.path("/search"))},r.toggleShareButton=function(){r.showShareButtons&&1==r.showShareButtons?r.showShareButtons=!1:r.showShareButtons=!0},r.openModal_flag=function(){o.modalInstance=c.open({templateUrl:"app-view/flag/FlagView.html"})},r.stopLoader=function(){o.loadingImage=!1},r.closeModal=function(){o.modalInstance.close()}}]),app.controller("ReportController",["$rootScope","$scope","$location","HttpService","$http","FlashService","$window",function(r,o,n,s,e,i,c){var l=this;r.pageTitle="Healthy Fling",o.states=r.stateList,o.regions=r.regionList,o.regions&&-1==o.regions.indexOf("Region")&&o.regions.unshift("Region"),o.categories=r.categoryList,o.selection=[],o.toggleSelection=function(e,t){var a=t.indexOf(e);-1<a?t.splice(a,1):t.push(e)},o.changeListInCtrl=function(e){if(""!=e&&null!=e&&"State"!=e&&"Provinces"!=e){r.regionList=r.masterList[e],o.regions=r.regionList,o.regions.unshift("Region");var a=o.regions;o.regions=a.filter(function(e,t){return a.indexOf(e)==t})}else"United States"!=l.country&&"Canada"!=l.country||(o.regions=["Region"])},o.changeStateListInCtrl=function(e){if(""!=e&&null!=e&&"Country"!=e)if(r.masterList=r.masterListAll[e],r.stateList=Object.keys(r.masterListAll[e]),o.states=r.stateList,"United States"!=e&&"Canada"!=e){r.regionList=r.masterList.State,o.regions=r.regionList,o.regions.unshift("Region");var a=o.regions;o.regions=a.filter(function(e,t){return a.indexOf(e)==t})}else"Canada"==e&&(l.state="Provinces")},o.updateList=function(e){r.regionList=r.masterList[e],o.regions=r.regionList,o.regions.unshift("Region")},l.post=function(){n.path("/post")},l.pages=function(){l.dataLoading=!0,n.path("/pages")},l.login=function(){r.modalInstance=$modal.open({templateUrl:"app-view/login/LoginView.html"})},l.logout=function(){l.dataLoading=!0,c.localStorage.removeItem("token"),n.path("/"),window.location.reload()},l.search=function(){r.search.state=this.state,r.search.region=this.region,r.search.category=this.category,n.path("/search")},l.post=function(){l.dataLoading=!0,n.path("/post")},l.search=function(){l.dataLoading=!0,n.path("/search")},o.initController=function(){e.get("/data.json").success(function(e){r.masterList=e})},o.reportPage=function(){o.showError=!0,o.showReasonError=!1,o.selection.length<1&&(o.showReasonError=!0);var e=n.path().split("/"),t=e[e.length-1];if(o.id=t,r.loading=!0,o.mainImage="https://placehold.it/710X420",o.showReasonError)c.scrollTo(0,0);else{o.showError=!1,o.closeModal();var a={flagreason:o.selection};s.ReportPageReason(t,a).then(function(e){"200"==e.status?(e&&e.data&&e.data._id&&(i.Success("The page is reported for review."),r.is_flagged=!0),r.loading=!1):(r.loading=!1,i.Error("There was an error while submitting your request. Please try again."),l.dataLoading=!1)})}},o.notify=function(){if(o.captcha)if(o.email){r.loading=!0;var e={htmlmessage:"<p>"+o.replymessage+"</p><p>"+n.absUrl().replace("reply","detail")+"</p><p><a href='mailto:"+o.email+"?subject=Re: "+o.title+"'>Reply to this message</a> </p> Regards, <br/>Healthyfling Team",subject:"Re: "+(o.title||o.message),sender1:o.sender1};s.SendMail(e).then(function(e){"200"==e.success||"250"==e.success?(r.loading=!1,alert("Email has been sent to the poster!")):(l.dataLoading=!1,r.loading=!1,alert("Email has been sent to the poster!"),n.path("/"))})}else alert("Email address is missing");else alert("Please accept the terms and condition.")},o.closeModal=function(){r.modalInstance.close()}}]),app.controller("SubscribeController",["$rootScope","$scope","$location","HttpService","$http","FlashService","$window",function(r,o,n,s,e,i,c){var l=this;r.pageTitle="Healthy Fling",o.states=r.stateList,o.regions=r.regionList,o.regions&&-1==o.regions.indexOf("Region")&&o.regions.unshift("Region"),o.categories=r.categoryList,o.selection=[],o.toggleSelection=function(e,t){var a=t.indexOf(e);-1<a?t.splice(a,1):t.push(e)},o.changeListInCtrl=function(e){if(""!=e&&null!=e&&"State"!=e&&"Provinces"!=e){r.regionList=r.masterList[e],o.regions=r.regionList,o.regions.unshift("Region");var a=o.regions;o.regions=a.filter(function(e,t){return a.indexOf(e)==t})}else"United States"!=l.country&&"Canada"!=l.country||(o.regions=["Region"])},o.changeStateListInCtrl=function(e){if(""!=e&&null!=e&&"Country"!=e)if(r.masterList=r.masterListAll[e],r.stateList=Object.keys(r.masterListAll[e]),o.states=r.stateList,"United States"!=e&&"Canada"!=e){r.regionList=r.masterList.State,o.regions=r.regionList,o.regions.unshift("Region");var a=o.regions;o.regions=a.filter(function(e,t){return a.indexOf(e)==t})}else"Canada"==e&&(l.state="Provinces")},o.updateList=function(e){r.regionList=r.masterList[e],o.regions=r.regionList,o.regions.unshift("Region")},l.post=function(){n.path("/post")},l.search=function(){r.search.state=this.state,r.search.region=this.region,r.search.category=this.category,n.path("/search")},l.post=function(){l.dataLoading=!0,n.path("/post")},l.search=function(){l.dataLoading=!0,n.path("/search")},o.initController=function(){e.get("/data.json").success(function(e){r.masterList=e})},o.resendPageLink=function(){r.loading=!0,o.showError=!1,o.closeModal();var e={email:o.email};s.ResendPageLink(e).then(function(e){"200"==e.status&&e.data&&e.data.sent?(i.Success("Email sent successfully!"),r.loading=!1):(r.loading=!1,i.Error("There was an error while submitting your request. Please try again."),l.dataLoading=!1)})},o.submit=function(){var e=n.path().split("/"),t=r.subscribePostId||e[e.length-1];if(o.id=t,r.loading=!0,o.mainImage="https://placehold.it/710X420",o.showReasonError)c.scrollTo(0,0);else{o.showError=!1,o.closeModal();var a={email:o.email};s.SubscribePost(t,a).then(function(e){r.subscribePostId=void 0,"200"==e.status?(e&&e.data&&e.data._id&&i.Success("You subscribed successfully!"),r.loading=!1):(r.loading=!1,i.Error("There was an error while submitting your request. Please try again."),l.dataLoading=!1)})}},o.submitPage=function(){var e=n.path().split("/"),t=r.subscribePageId||e[e.length-1];if(o.id=t,r.loading=!0,o.mainImage="https://placehold.it/710X420",o.showReasonError)c.scrollTo(0,0);else{o.showError=!1,o.closeModal();var a={email:o.email};s.SubscribePage(t,a).then(function(e){r.subscribePageId=void 0,"200"==e.status?(e&&e.data&&e.data._id&&i.Success("You subscribed successfully!"),e&&'"EMAIL_ALREADY_SUBSCRIBED"'==e.data&&i.Error("You already subscribed with this email."),r.loading=!1):(r.loading=!1,i.Error("There was an error while submitting your request. Please try again."),l.dataLoading=!1)})}},o.notify=function(){if(o.captcha)if(o.email){r.loading=!0;var e={htmlmessage:"<p>"+o.replymessage+"</p><p>"+n.absUrl().replace("reply","detail")+"</p><p><a href='mailto:"+o.email+"?subject=Re: "+o.title+"'>Reply to this message</a> </p> Regards, <br/>Healthyfling Team",subject:"Re: "+(o.title||o.message),sender1:o.sender1};s.SendMail(e).then(function(e){"200"==e.success||"250"==e.success?(r.loading=!1,alert("Email has been sent to the poster!")):(l.dataLoading=!1,r.loading=!1,alert("Email has been sent to the poster!"),n.path("/"))})}else alert("Email address is missing");else alert("Please accept the terms and condition.")},o.closeModal=function(){r.modalInstance.close()}}]),app.controller("LoginController",["$rootScope","$scope","$location","HttpService","$http","FlashService","$window",function(t,e,a,r,o,n,s){var i=this;e.submit=function(){e.email?(t.loading=!0,e.closeModal(),r.Login({email:e.email}).then(function(e){"200"==e.status?(t.loading=!1,n.Success("Authentication link has been sent on your email!")):(i.dataLoading=!1,t.loading=!1,n.Error("There was an error while submitting your request. Please try again."))})):alert("Email is not valid!")},e.closeModal=function(){t.modalInstance.close()}}]),app.controller("PostController",["$rootScope","$scope","$location","HttpService","$window","$modal","FlashService","MetaService","$timeout","$route",function(o,n,a,s,i,e,c,t,r,l){var g=this;n.params=a.search(),o.metaservice=t,o.metaservice.set("Post an ad"),n.imageUrl=[{}],n.addImageUrlField=function(){n.imageUrl.push({})},window.onbeforeunload=function(e){if(-1<a.path().indexOf("/post")&&("/post"===a.path().slice(0,6)||"/post?"===a.path().slice(0,6)))return(e=e||window.event)&&(e.returnValue="Sure?"),"Sure?"},n.countries=o.countryList,n.states=o.stateList,n.regions=o.regionList,n.newstates=["State"],n.newregions=[],n.haircolors=o.haircolorList,n.heights=o.heightList,n.ethnicity=o.ethnicityList,n.orientation=o.orientationList,n.bodytype=o.bodytypeList,n.eyecolor=o.eyecolorList,n.status=o.statusList,n.gender=o.genderList,n.bodyhair=o.bodyHairList,n.hivstatus=o.hivstatusList,n.anonymouscomment=["enabled","disabled"],n.notified=["yes","no"],n.postermode=["Personals","Pages"];for(var d=["Age"],h=0;h<201;h++)d.push(h);n.ageRange=d,d=["Weight"];for(h=90;h<501;h++)d.push(h);n.weightRange=d,n.regions&&-1==n.regions.indexOf("Region")&&n.regions.unshift("Region"),n.categories=o.categoryList,n.savedPreference="locked"==o.savedPreference,g.savedPreference="locked"==o.savedPreference,g.country=o.search.country||"Country",g.state=o.search.state||"State",g.region=o.search.region||"Region",g.category=o.search.category||"Category",o.imageList=[],o.profilePic=[],o.coverPic=[],n.changeListInCtrl=function(e){if(""!=e&&null!=e&&"State"!=e&&"Provinces"!=e){o.regionList=o.masterList[e],n.regions=o.regionList,n.regions.unshift("Region");var a=n.regions;n.regions=a.filter(function(e,t){return a.indexOf(e)==t})}else"United States"!=g.country&&"Canada"!=g.country||(n.regions=["Region"])},n.changeStateListInCtrl=function(e){if(""!=e&&null!=e&&"Country"!=e)if(o.masterList=o.masterListAll[e],o.stateList=Object.keys(o.masterListAll[e]),n.states=o.stateList,"United States"!=e&&"Canada"!=e){o.regionList=o.masterList.State,n.regions=o.regionList,n.regions.unshift("Region");var a=n.regions;n.regions=a.filter(function(e,t){return a.indexOf(e)==t})}else"Canada"==e&&(g.state="Provinces")},n.changeNewPostList=function(e){if(""!=e&&null!=e&&"State"!=e&&"Provinces"!=e){n.newregions=n.newmasterList[e],n.newregions.unshift("Region");var a=n.newregions;n.newregions=a.filter(function(e,t){return a.indexOf(e)==t})}else n.newregions=["Region"]},n.changeNewPostStateList=function(e){if(""!=e&&null!=e&&"Country"!=e&&(n.newmasterList=o.masterListAll[e],n.newstates=Object.keys(o.masterListAll[e]),"United States"!=e&&"Canada"!=e)){n.newregions=n.newmasterList.State,n.newregions.unshift("Region");var a=n.newregions;n.newregions=a.filter(function(e,t){return a.indexOf(e)==t})}},g.lockPreference=function(){i.localStorage.setItem("healthyfling_preference","locked"),i.localStorage.setItem("healthyfling_preference_country",g.country),i.localStorage.setItem("healthyfling_preference_state",g.state),i.localStorage.setItem("healthyfling_preference_region",g.region),i.localStorage.setItem("healthyfling_preference_category",g.category),o.savedPreference=!0,g.savedPreference=!0,n.savedPreference="locked",c.Success("Search preference saved for easier browsing.")},g.unlockPreference=function(){i.localStorage.setItem("healthyfling_preference","unlocked"),g.country=o.search.country="Country",g.state=o.search.state="State",g.region=o.search.region="Region",g.category=o.search.category="Category",o.savedPreference=!1,g.savedPreference=!1,n.savedPreference="unlocked",c.Success("Search preference has been deleted.")},n.stopLoader=function(){o.loadingImage=!1,o.loadingProfileImage=!1,o.loadingCoverImage=!1},n.deleteImage=function(e){o.imageList.splice(e,1),g.data.files=o.imageList},n.deleteProfilePic=function(){o.profilePic=[]},n.deleteCoverPic=function(){o.coverPic=[]},g.files=[],g.post=function(){a.path("/post")},g.pages=function(){g.dataLoading=!0,a.path("/pages")},g.login=function(){o.modalInstance=e.open({templateUrl:"app-view/login/LoginView.html"})},g.logout=function(){g.dataLoading=!0,i.localStorage.removeItem("token"),a.path("/"),window.location.reload()},g.check=function(){0<g.data.files.length&&alert(g.data.files.length+" files selected ... Max allowed files is 5.")},g.search=function(){o.search.country=this.country,o.search.state=this.state,o.search.region=this.region,o.search.category=this.category,a.path("/search")},g.data={title:"",country:"Country",state:"State",region:"Region",category:"Category",location:"",age:"",message:"",haircolor:"Hair Color",height:"Height",ethnicity:"Ethnicity",orientation:"Orientation",bodytype:"Body Type",eyecolor:"Eye Color",mstatus:"Status",gender:"Gender",bodyhair:"Body Hair",hivstatus:"HIV Status",anonymouscomment:"disabled",notified:"no",share:"disabled",embed:"",weight:"Weight",mage:"Age",postermode:"Personals",imageURL:[]},n.update=function(){"Pages"===g.data.postermode&&s.GetPageForCurrentUser().then(function(e){"200"==e.status&&(a.search({page:!0,addPost:!0}),r(function(){l.reload()},0))})},n.params.editPage||!n.params.page||n.params.page.length||(g.data.postermode="Pages",s.GetPageForCurrentUser().then(function(e){"200"==e.status&&(e.data&&e.data._id?(n.pageIdExists=!0,o.profilePic=[],o.coverPic=[],n.page=e.data,o.profilePic=[n.page.profilePic],o.coverPic=[n.page.coverPic],g.data.pageLocation=n.page.location,g.data.pageWebsite=n.page.website,g.data.pageTitle=n.page.title):(n.pageIdExists=!1,n.params.editPage=!1),n.params.page=!0,n.params.addPost=!0,a.search({page:!0,addPost:!0}))})),n.params.editPage&&n.params.page&&n.params.page.length&&(g.data.postermode="Pages",s.GetPageForCurrentUser().then(function(e){"200"==e.status&&(e.data?(n.pageIdExists=!0,o.profilePic=[],o.coverPic=[],n.params.page=!0,n.params.editPage=!0,n.page=e.data,o.profilePic=[n.page.profilePic],o.coverPic=[n.page.coverPic],g.data.pageLocation=n.page.location,g.data.pageWebsite=n.page.website,g.data.pageTitle=n.page.title,a.search({page:!0,editPage:!0})):(alert("Unauthorized request"),a.path("/")))})),g.addPost=function(){if(g.showImageError=!1,g.showRequiredCountryError=!1,g.showRequiredStateError=!1,g.showRequiredRegionError=!1,g.showRequiredCategoryError=!1,g.showMessageError=!1,g.showTitleError=!1,g.showCaptchaError=!1,g.showAgeError=!1,g.showError=!0,o.imageList&&20<o.imageList.length&&(g.showImageError=!0,g.imageLength=o.imageList.length),g.data.country&&"Country"!=g.data.country||(g.showRequiredCountryError=!0),g.data.state&&"State"!=g.data.state&&"Provinces"!=g.data.state||"United States"!=g.data.country&&"Canada"!=g.data.country||(g.showRequiredStateError=!0),g.data.region&&"Region"!=g.data.region||(g.showRequiredRegionError=!0),g.data.category&&"Category"!=g.data.category||(g.showRequiredCategoryError=!0),g.data.title||(g.showTitleError=!0),g.data.message||(g.showMessageError=!0),g.captcha||(g.showCaptchaError=!0),g.data.age&&isNaN(g.data.age)&&(g.showAgeError=!0),"Hair Color"==g.data.haircolor&&(g.data.haircolor=""),"Height"==g.data.height&&(g.data.height=""),"Ethnicity"==g.data.ethnicity&&(g.data.ethnicity=""),"Orientation"==g.data.orientation&&(g.data.orientation=""),"Body Type"==g.data.bodytype&&(g.data.bodytype=""),"Eye Color"==g.data.eyecolor&&(g.data.eyecolor=""),"Status"==g.data.mstatus&&(g.data.mstatus=""),"Gender"==g.data.gender&&(g.data.gender=""),"Body Hair"==g.data.bodyhair&&(g.data.bodyhair=""),"HIV Status"==g.data.hivstatus&&(g.data.hivstatus=""),"Age"==g.data.mage&&(g.data.mage=""),"Weight"==g.data.weight&&(g.data.weight=""),g.showRequiredStateError||g.showRequiredCountryError||g.showRequiredRegionError||g.showAgeError||g.showRequiredCategoryError||g.showMessageError||g.showCaptchaError||g.showImageError||g.showTitleError)i.scrollTo(0,0),""==g.data.mage&&(g.data.mage="Age"),""==g.data.haircolor&&(g.data.haircolor="Hair Color"),""==g.data.height&&(g.data.height="Height"),""==g.data.ethnicity&&(g.data.ethnicity="Ethnicity"),""==g.data.orientation&&(g.data.orientation="Orientation"),""==g.data.bodytype&&(g.data.bodytype="Body Type"),""==g.data.eyecolor&&(g.data.eyecolor="Eye Color"),""==g.data.mstatus&&(g.data.mstatus="Status"),""==g.data.gender&&(g.data.gender="Gender"),""==g.data.bodyhair&&(g.data.bodyhair="Body Hair"),""==g.data.hivstatus&&(g.data.hivstatus="HIV Status"),""==g.data.weight&&(g.data.weight="Weight");else{g.showError=!1,g.showImageError=!1,o.loading=!0;var e={title:this.data.title,country:this.data.country,state:this.data.state,region:this.data.region,category:this.data.category,location:this.data.location,age:this.data.age,message:this.data.message,haircolor:this.data.haircolor,height:this.data.height,ethnicity:this.data.ethnicity,orientation:this.data.orientation,bodytype:this.data.bodytype,eyecolor:this.data.eyecolor,mstatus:this.data.mstatus,gender:this.data.gender,bodyhair:this.data.bodyhair,hivstatus:this.data.hivstatus,anonymouscomment:this.data.anonymouscomment,notified:this.data.notified,city:this.data.city,zip:this.data.zip,share:this.data.share,embed:this.data.embed.replace("src=","xxx=").replace("href=","yyyy="),weight:this.data.weight,mage:this.data.mage,files:o.imageList,postermode:this.data.postermode};s.AddPost(e).then(function(e){"200"==e.status?(e&&e.data&&e.data._id?(c.Success("Completed successfully"),a.search({success:!0}),a.path("/detail/"+e.data._id)):e&&e.data&&"limit reached"==e.data.data&&(""==g.data.mage&&(g.data.mage="Age"),""==g.data.haircolor&&(g.data.haircolor="Hair Color"),""==g.data.height&&(g.data.height="Height"),""==g.data.ethnicity&&(g.data.ethnicity="Ethnicity"),""==g.data.orientation&&(g.data.orientation="Orientation"),""==g.data.bodytype&&(g.data.bodytype="Body Type"),""==g.data.eyecolor&&(g.data.eyecolor="Eye Color"),""==g.data.mstatus&&(g.data.mstatus="Status"),""==g.data.gender&&(g.data.gender="Gender"),""==g.data.bodyhair&&(g.data.bodyhair="Body Hair"),""==g.data.hivstatus&&(g.data.hivstatus="HIV Status"),""==g.data.weight&&(g.data.weight="Weight"),c.Error("Maximum Limit Reached: You have too many posts at one time. You can delete some posts or wait till your other posts expire!"),i.scrollTo(0,0)),o.loading=!1):(o.loading=!1,g.dataLoading=!1,a.path("/"))})}},g.addPostAndPage=function(){if(g.showImageError=!1,g.showMessageError=!1,g.showTitleError=!1,g.showPageTitleError=!1,g.showCaptchaError=!1,g.showError=!0,o.imageList&&20<o.imageList.length&&(g.showImageError=!0,g.imageLength=o.imageList.length),n.params.page&&!(n.params.page&&n.params.page.length<8)||g.data.pageTitle||(g.showPageTitleError=!0),g.data.title||(g.showTitleError=!0),g.data.message||(g.showMessageError=!0),g.captcha||(g.showCaptchaError=!0),n.page||(n.page={}),g.showPageTitleError||g.showTitleError||g.showMessageError||g.showCaptchaError||g.showImageError)i.scrollTo(0,0);else{if(g.showError=!1,g.showImageError=!1,o.loading=!0,n.imageUrl){n.imageUrl.map(function(e){o.imageList.push({secure_url:e.secure_url,resource_type:"imageURL",signature:e.signature||""})}),o.imageList=(t=o.imageList,r="secure_url",t.filter(function(e,t,a){return a.map(function(e){return e[r]}).indexOf(e[r])===t}))}var e={pageId:n.page._id,pageTitle:this.data.pageTitle,pageMessage:this.data.pageMessage,profilePic:o.profilePic&&o.profilePic.length?o.profilePic[0]:null,coverPic:o.coverPic&&o.coverPic.length?o.coverPic[0]:null,location:this.data.pageLocation,website:this.data.pageWebsite,title:this.data.title,message:this.data.message,anonymouscomment:this.data.anonymouscomment,notified:this.data.notified,share:this.data.share,sharedData:this.data.sharedData,embed:this.data.embed.replace("src=","xxx=").replace("href=","yyyy="),embedDescription:this.data.embedDescription,files:o.imageList,postermode:this.data.postermode};s.AddPostWithPage(e).then(function(e){"200"==e.status?(e&&e.data&&e.data._id?(c.Success("Completed successfully"),a.search({success:!0}),a.path("/page/"+e.data.page.url+"/post/"+e.data._id)):e&&e.data&&"limit reached"==e.data.data?(c.Error("Maximum Limit Reached: You have too many posts at one time. You can delete some posts or wait till your other posts expire!"),i.scrollTo(0,0)):e&&e.data&&11e3==e.data.code&&(c.Error("The page title is already in use, please, rename it!"),i.scrollTo(0,0)),o.loading=!1):(o.loading=!1,g.dataLoading=!1,a.path("/"))})}var t,r},g.updatePage=function(){o.loading=!0;var e={profilePic:o.profilePic&&o.profilePic.length?o.profilePic[0]:null,coverPic:o.coverPic&&o.coverPic.length?o.coverPic[0]:null,location:this.data.pageLocation,website:this.data.pageWebsite};s.EditPage(n.page._id,e).then(function(e){"200"==e.status?(o.loading=!1,a.search({}),a.path("/"+n.page.url)):(o.loading=!1,g.dataLoading=!1,a.path("/"))})},n.resendPageLink=function(){o.modalInstance=e.open({templateUrl:"app-view/subscribe/ResendPageLink.html"})}}]),app.controller("SearchController",["$rootScope","$scope","$location","HttpService","$window","FlashService","$modal","MetaService",function(o,t,a,e,r,n,s,i){var c=this;a.search({}),o.metaservice=i,o.metaservice.set(),t.countries=o.countryList,t.states=o.stateList,t.regions=o.regionList,o.savedPreference=r.localStorage.getItem("healthyfling_preference"),"locked"==o.savedPreference&&(o.search.country=r.localStorage.getItem("healthyfling_preference_country")||"Country",o.search.state=r.localStorage.getItem("healthyfling_preference_state")||"State",o.search.region=r.localStorage.getItem("healthyfling_preference_region")||"Region",o.search.category=r.localStorage.getItem("healthyfling_preference_category")||"Category"),t.savedPreference="locked"==o.savedPreference,c.savedPreference="locked"==o.savedPreference,t.regions&&-1==t.regions.indexOf("Region")&&t.regions.unshift("Region"),t.categories=o.categoryList,t.changeListInCtrl=function(e){if(""!=e&&null!=e&&"State"!=e&&"Provinces"!=e){o.regionList=o.masterList[e],t.regions=o.regionList,t.regions.unshift("Region");var a=t.regions;t.regions=a.filter(function(e,t){return a.indexOf(e)==t})}else"United States"!=c.country&&"Canada"!=c.country||(t.regions=["Region"])},t.changeStateListInCtrl=function(e){if(""!=e&&null!=e&&"Country"!=e)if(o.masterList=o.masterListAll[e],o.stateList=Object.keys(o.masterListAll[e]),t.states=o.stateList,"United States"!=e&&"Canada"!=e){o.regionList=o.masterList.State,t.regions=o.regionList,t.regions.unshift("Region");var a=t.regions;t.regions=a.filter(function(e,t){return a.indexOf(e)==t})}else"Canada"==e&&(c.state="Provinces")},o.loading=!0,o.adPosts={};var l=a.search();c.currentPage=l.page||0,c.pageSize=100,c.country=o.search.country||"Country",c.state=o.search.state||"State",c.region=o.search.region||"Region",c.category=o.search.category||"Category",c.post=function(){a.path("/post")},c.pages=function(){c.dataLoading=!0,a.path("/pages")},c.login=function(){o.modalInstance=s.open({templateUrl:"app-view/login/LoginView.html"})},c.logout=function(){c.dataLoading=!0,r.localStorage.removeItem("token"),a.path("/"),window.location.reload()},c.lockPreference=function(){r.localStorage.setItem("healthyfling_preference","locked"),r.localStorage.setItem("healthyfling_preference_country",c.country),r.localStorage.setItem("healthyfling_preference_state",c.state),r.localStorage.setItem("healthyfling_preference_region",c.region),r.localStorage.setItem("healthyfling_preference_category",c.category),o.savedPreference=!0,c.savedPreference=!0,t.savedPreference="locked",n.Success("Search preference saved for easier browsing.")},c.unlockPreference=function(){r.localStorage.setItem("healthyfling_preference","unlocked"),c.country=o.search.country="Country",c.state=o.search.state="State",c.region=o.search.region="Region",c.category=o.search.category="Category",o.savedPreference=!1,c.savedPreference=!1,t.savedPreference="unlocked",n.Success("Search preference has been deleted.")},c.search=function(){o.search.country=c.country,o.search.state=c.state,o.search.region=c.region,o.search.category=c.category,this.reloadSearch()},c.searchAll=function(){o.savedPreference=r.localStorage.getItem("healthyfling_preference"),"locked"==o.savedPreference?(o.search.country=r.localStorage.getItem("healthyfling_preference_country")||"Country",o.search.state=r.localStorage.getItem("healthyfling_preference_state")||"State",o.search.region=r.localStorage.getItem("healthyfling_preference_region")||"Region",o.search.category=r.localStorage.getItem("healthyfling_preference_category")||"Category",c.country=o.search.country||"Country",c.state=o.search.state||"State",c.region=o.search.region||"Region",c.category=o.search.category||"Category"):(c.country="Country",c.state="State",c.region="Region",c.category="Category",o.search.country=c.country,o.search.state=c.state,o.search.region=c.region,o.search.category=c.category),o.loading=!0,e.GetAllPosts().then(function(e){if("200"==e.status){o.adPosts.data=[];for(var t=0;t<e.data.length;t++)o.adPosts.data.push(e.data[t]);o.refreshAds(),o.loading=!1}else c.dataLoading=!1,a.path("/"),o.loading=!1})},c.searchFilter=function(e,t,a,r){"Country"==e&&"State"==t&&"Region"==a||(o.search.country=e,c.country=e,o.search.state=t,c.state=t,o.search.region=a,c.region=a,o.search.category=r,c.category=r,this.reloadSearch())},c.reloadSearch=function(){o.loading=!0,e.GetPosts().then(function(e){if("200"==e.status){o.adPosts.data=[];for(var t=0;t<e.data.length;t++)o.adPosts.data.push(e.data[t]);o.refreshAds(),o.loading=!1}else c.dataLoading=!1,a.path("/"),o.loading=!1})},c.nextPage=function(){c.currentPage=c.currentPage+1,a.search("page",c.currentPage)},c.prevPage=function(){c.currentPage=c.currentPage-1,a.search("page",c.currentPage)},t.initController=function(){o.loading=!0,e.GetPosts().then(function(e){if("200"==e.status){o.visitedSearchPage=!0,o.adPosts.data=[];for(var t=0;t<e.data.length;t++)o.adPosts.data.push(e.data[t]);o.refreshAds(),o.loading=!1}else c.dataLoading=!1,a.path("/"),o.loading=!1})},t.openModal_subscribe=function(e){o.subscribePostId=e,o.modalInstance=s.open({templateUrl:"app-view/subscribe/SubscribeView.html"})}}]),app.filter("startFrom",function(){return function(e,t){return t=+t,e?e.slice(t):0}}),app.filter("roundup",function(){return function(e){return Math.ceil(e)}}),app.controller("AdsController",["$scope","$rootScope","$location","HttpService","$window",function(e,a,r,t,o){var n={};a.savedPreference=o.localStorage.getItem("healthyfling_preference"),"locked"==a.savedPreference&&(a.search.country=o.localStorage.getItem("healthyfling_preference_country")||"Country",a.search.state=o.localStorage.getItem("healthyfling_preference_state")||"State",a.search.region=o.localStorage.getItem("healthyfling_preference_region")||"Region",a.search.category=o.localStorage.getItem("healthyfling_preference_category")||"Category"),e.savedPreference="locked"==a.savedPreference,n.savedPreference="locked"==a.savedPreference,n.country=a.search.country,n.state=a.search.state,n.region=a.search.region,n.category=a.search.category,a.loading=!0,a.currentPost={},a.viewDetail=function(e){a.currentPost.data=e,r.path("/detail/"+e._id)},a.refreshAds=function(){t.GetPosts().then(function(e){if("200"==e.status){a.adPosts.data=[],"Region"!=a.search.region&&""!=a.search.region?a.pageTitle=a.search.region:a.pageTitle="All Regions";for(var t=0;t<e.data.length;t++)a.adPosts.data.push(e.data[t]);a.loading=!1}else a.loading=!1,n.dataLoading=!1,r.path("/")}),e.data=a.adPosts.data.reverse()}}]),app.controller("PagesController",["$rootScope","$scope","$location","HttpService","$window","FlashService","$modal","MetaService",function(o,t,a,e,r,n,s,i){var c=this;o.metaservice=i,o.metaservice.set(),t.diffDate=function(e){var t=new Date(e),a=new Date,r=Math.abs(a.getTime()-t.getTime());return Math.ceil(r/864e5)},t.createPage=function(){if(!o.isLoggedIn)return alert("You need to be logged in!")},o.pageTitle="Healthy Fling",t.countries=o.countryList,t.states=o.stateList,t.regions=o.regionList,o.savedPreference=r.localStorage.getItem("healthyfling_preference"),"locked"==o.savedPreference&&(o.search.country=r.localStorage.getItem("healthyfling_preference_country")||"Country",o.search.state=r.localStorage.getItem("healthyfling_preference_state")||"State",o.search.region=r.localStorage.getItem("healthyfling_preference_region")||"Region",o.search.category=r.localStorage.getItem("healthyfling_preference_category")||"Category"),t.savedPreference="locked"==o.savedPreference,c.savedPreference="locked"==o.savedPreference,t.regions&&-1==t.regions.indexOf("Region")&&t.regions.unshift("Region"),t.categories=o.categoryList,t.changeListInCtrl=function(e){if(""!=e&&null!=e&&"State"!=e&&"Provinces"!=e){o.regionList=o.masterList[e],t.regions=o.regionList,t.regions.unshift("Region");var a=t.regions;t.regions=a.filter(function(e,t){return a.indexOf(e)==t})}else"United States"!=c.country&&"Canada"!=c.country||(t.regions=["Region"])},t.changeStateListInCtrl=function(e){if(""!=e&&null!=e&&"Country"!=e)if(o.masterList=o.masterListAll[e],o.stateList=Object.keys(o.masterListAll[e]),t.states=o.stateList,"United States"!=e&&"Canada"!=e){o.regionList=o.masterList.State,t.regions=o.regionList,t.regions.unshift("Region");var a=t.regions;t.regions=a.filter(function(e,t){return a.indexOf(e)==t})}else"Canada"==e&&(c.state="Provinces")},o.loading=!0,o.adPosts={};var l=a.search();c.currentPage=l.page||0,c.pageSize=100,c.country=o.search.country||"Country",c.state=o.search.state||"State",c.region=o.search.region||"Region",c.category=o.search.category||"Category",c.post=function(){a.path("/post")},c.pages=function(){c.dataLoading=!0,a.path("/pages")},c.login=function(){o.modalInstance=s.open({templateUrl:"app-view/login/LoginView.html"})},c.logout=function(){c.dataLoading=!0,r.localStorage.removeItem("token"),a.path("/"),window.location.reload()},c.lockPreference=function(){r.localStorage.setItem("healthyfling_preference","locked"),r.localStorage.setItem("healthyfling_preference_country",c.country),r.localStorage.setItem("healthyfling_preference_state",c.state),r.localStorage.setItem("healthyfling_preference_region",c.region),r.localStorage.setItem("healthyfling_preference_category",c.category),o.savedPreference=!0,c.savedPreference=!0,t.savedPreference="locked",n.Success("Search preference saved for easier browsing.")},c.unlockPreference=function(){r.localStorage.setItem("healthyfling_preference","unlocked"),c.country=o.search.country="Country",c.state=o.search.state="State",c.region=o.search.region="Region",c.category=o.search.category="Category",o.savedPreference=!1,c.savedPreference=!1,t.savedPreference="unlocked",n.Success("Search preference has been deleted.")},c.search=function(){o.search.country=c.country,o.search.state=c.state,o.search.region=c.region,o.search.category=c.category,a.path("/search")},c.searchAll=function(){o.savedPreference=r.localStorage.getItem("healthyfling_preference"),"locked"==o.savedPreference?(o.search.country=r.localStorage.getItem("healthyfling_preference_country")||"Country",o.search.state=r.localStorage.getItem("healthyfling_preference_state")||"State",o.search.region=r.localStorage.getItem("healthyfling_preference_region")||"Region",o.search.category=r.localStorage.getItem("healthyfling_preference_category")||"Category",c.country=o.search.country||"Country",c.state=o.search.state||"State",c.region=o.search.region||"Region",c.category=o.search.category||"Category"):(c.country="Country",c.state="State",c.region="Region",c.category="Category",o.search.country=c.country,o.search.state=c.state,o.search.region=c.region,o.search.category=c.category),o.loading=!0,e.GetAllPosts().then(function(e){if("200"==e.status){o.adPosts.data=[];for(var t=0;t<e.data.length;t++)o.adPosts.data.push(e.data[t]);o.refreshAds(),o.loading=!1}else c.dataLoading=!1,a.path("/"),o.loading=!1})},c.searchFilter=function(e,t,a,r){"Country"==e&&"State"==t&&"Region"==a||(o.search.country=e,c.country=e,o.search.state=t,c.state=t,o.search.region=a,c.region=a,o.search.category=r,c.category=r,this.reloadSearch())},c.reloadSearch=function(){o.loading=!0,e.GetPosts().then(function(e){if("200"==e.status){o.adPosts.data=[];for(var t=0;t<e.data.length;t++)o.adPosts.data.push(e.data[t]);o.refreshAds(),o.loading=!1}else c.dataLoading=!1,a.path("/"),o.loading=!1})},c.nextPage=function(){c.currentPage=c.currentPage+1,a.search("page",c.currentPage)},c.prevPage=function(){c.currentPage=c.currentPage-1,a.search("page",c.currentPage)},t.initController=function(){a.search({page:null}),o.loading=!0,e.GetPagePosts().then(function(e){if("200"==e.status){o.visitedSearchPage=!0,o.adPosts.data=[];for(var t=0;t<e.data.length;t++)o.adPosts.data.push(e.data[t]);o.refreshAds(),o.loading=!1}else c.dataLoading=!1,a.path("/"),o.loading=!1})},t.openModal_subscribe=function(e){o.subscribePostId=e,o.modalInstance=s.open({templateUrl:"app-view/subscribe/SubscribeView.html"})}}]),app.filter("startFrom",function(){return function(e,t){return t=+t,e?e.slice(t):0}}),app.filter("roundup",function(){return function(e){return Math.ceil(e)}}),app.controller("AdsController",["$scope","$rootScope","$location","HttpService","$window",function(e,a,r,t,o){var n={};a.savedPreference=o.localStorage.getItem("healthyfling_preference"),"locked"==a.savedPreference&&(a.search.country=o.localStorage.getItem("healthyfling_preference_country")||"Country",a.search.state=o.localStorage.getItem("healthyfling_preference_state")||"State",a.search.region=o.localStorage.getItem("healthyfling_preference_region")||"Region",a.search.category=o.localStorage.getItem("healthyfling_preference_category")||"Category"),e.savedPreference="locked"==a.savedPreference,n.savedPreference="locked"==a.savedPreference,n.country=a.search.country,n.state=a.search.state,n.region=a.search.region,n.category=a.search.category,a.loading=!0,a.currentPost={},a.viewDetail=function(e){a.currentPost.data=e,r.path("/detail/"+e._id)},a.refreshAds=function(){t.GetPagePosts().then(function(e){if("200"==e.status){a.adPosts.data=[],"Region"!=a.search.region&&""!=a.search.region?a.pageTitle=a.search.region:a.pageTitle="All Regions";for(var t=0;t<e.data.length;t++)a.adPosts.data.push(e.data[t]);a.loading=!1}else a.loading=!1,n.dataLoading=!1,r.path("/")}),e.data=a.adPosts.data.reverse()}}]),app.controller("PageController",["$rootScope","$scope","$location","HttpService","$window","FlashService","$modal","$routeParams","MetaService",function(o,r,n,t,e,s,a,i,c){var l=this;r.diffDate=function(e){var t=new Date(e),a=new Date,r=Math.abs(a.getTime()-t.getTime());return Math.ceil(r/864e5)},r.likePage=function(e){if(!o.isLoggedIn)return alert("You need to be logged in!");window.localStorage.getItem(e)||(window.localStorage.setItem(e,!0),t.LikePage(e).then(function(e){r.pageData.like=r.pageData.like+1}))},r.dislikePage=function(e){if(!o.isLoggedIn)return alert("You need to be logged in!");window.localStorage.getItem(e)||(window.localStorage.setItem(e,!0),t.DislikePage(e).then(function(e){r.pageData.dislike=r.pageData.dislike+1}))},r.messageModal=function(){o.modalInstance=a.open({templateUrl:"app-view/reply/ReplyView.html"})},r.currentPath=n.absUrl(),r.countries=o.countryList,r.states=o.stateList,r.regions=o.regionList,o.savedPreference=e.localStorage.getItem("healthyfling_preference"),"locked"==o.savedPreference&&(o.search.country=e.localStorage.getItem("healthyfling_preference_country")||"Country",o.search.state=e.localStorage.getItem("healthyfling_preference_state")||"State",o.search.region=e.localStorage.getItem("healthyfling_preference_region")||"Region",o.search.category=e.localStorage.getItem("healthyfling_preference_category")||"Category"),r.savedPreference="locked"==o.savedPreference,l.savedPreference="locked"==o.savedPreference,r.regions&&-1==r.regions.indexOf("Region")&&r.regions.unshift("Region"),r.categories=o.categoryList,r.changeListInCtrl=function(e){if(""!=e&&null!=e&&"State"!=e&&"Provinces"!=e){o.regionList=o.masterList[e],r.regions=o.regionList,r.regions.unshift("Region");var a=r.regions;r.regions=a.filter(function(e,t){return a.indexOf(e)==t})}else"United States"!=l.country&&"Canada"!=l.country||(r.regions=["Region"])},r.changeStateListInCtrl=function(e){if(""!=e&&null!=e&&"Country"!=e)if(o.masterList=o.masterListAll[e],o.stateList=Object.keys(o.masterListAll[e]),r.states=o.stateList,"United States"!=e&&"Canada"!=e){o.regionList=o.masterList.State,r.regions=o.regionList,r.regions.unshift("Region");var a=r.regions;r.regions=a.filter(function(e,t){return a.indexOf(e)==t})}else"Canada"==e&&(l.state="Provinces")},o.loading=!0,o.adPosts={};var g=n.search();l.currentPage=g.page||0,l.pageSize=100,l.country=o.search.country||"Country",l.state=o.search.state||"State",l.region=o.search.region||"Region",l.category=o.search.category||"Category",l.post=function(){n.path("/post")},l.pages=function(){l.dataLoading=!0,n.path("/pages")},l.login=function(){o.modalInstance=a.open({templateUrl:"app-view/login/LoginView.html"})},l.logout=function(){l.dataLoading=!0,e.localStorage.removeItem("token"),n.path("/"),window.location.reload()},l.lockPreference=function(){e.localStorage.setItem("healthyfling_preference","locked"),e.localStorage.setItem("healthyfling_preference_country",l.country),e.localStorage.setItem("healthyfling_preference_state",l.state),e.localStorage.setItem("healthyfling_preference_region",l.region),e.localStorage.setItem("healthyfling_preference_category",l.category),o.savedPreference=!0,l.savedPreference=!0,r.savedPreference="locked",s.Success("Search preference saved for easier browsing.")},l.unlockPreference=function(){e.localStorage.setItem("healthyfling_preference","unlocked"),l.country=o.search.country="Country",l.state=o.search.state="State",l.region=o.search.region="Region",l.category=o.search.category="Category",o.savedPreference=!1,l.savedPreference=!1,r.savedPreference="unlocked",s.Success("Search preference has been deleted.")},l.search=function(){o.loading=!0,o.search.country=this.country,o.search.state=this.state,o.search.region=this.region,o.search.category=this.category,n.path("/search")},l.searchFilter=function(e,t,a,r){"Country"==e&&"State"==t&&"Region"==a||(o.loading=!0,o.search.country=e,o.search.state=t,o.search.region=a,o.search.category=r,n.path("/search"))},l.searchAll=function(){o.savedPreference=e.localStorage.getItem("healthyfling_preference"),"locked"==o.savedPreference?(o.search.country=e.localStorage.getItem("healthyfling_preference_country")||"Country",o.search.state=e.localStorage.getItem("healthyfling_preference_state")||"State",o.search.region=e.localStorage.getItem("healthyfling_preference_region")||"Region",o.search.category=e.localStorage.getItem("healthyfling_preference_category")||"Category",l.country=o.search.country||"Country",l.state=o.search.state||"State",l.region=o.search.region||"Region",l.category=o.search.category||"Category"):(l.country="Country",l.state="State",l.region="Region",l.category="Category",o.search.country=l.country,o.search.state=l.state,o.search.region=l.region,o.search.category=l.category),o.loading=!0,t.GetAllPosts().then(function(e){if("200"==e.status){o.adPosts.data=[];for(var t=0;t<e.data.length;t++)o.adPosts.data.push(e.data[t]);o.refreshAds(),o.loading=!1}else l.dataLoading=!1,n.path("/"),o.loading=!1})},l.searchFilter=function(e,t,a,r){"Country"==e&&"State"==t&&"Region"==a||(o.search.country=e,l.country=e,o.search.state=t,l.state=t,o.search.region=a,l.region=a,o.search.category=r,l.category=r,this.reloadSearch())},l.reloadSearch=function(){o.loading=!0,t.GetPosts().then(function(e){if("200"==e.status){o.adPosts.data=[];for(var t=0;t<e.data.length;t++)o.adPosts.data.push(e.data[t]);o.refreshAds(),o.loading=!1}else l.dataLoading=!1,n.path("/"),o.loading=!1})},l.nextPage=function(){l.currentPage=l.currentPage+1,n.search("page",l.currentPage)},l.prevPage=function(){l.currentPage=l.currentPage-1,n.search("page",l.currentPage)},r.params=n.search(),r.toggleShareButton=function(){r.showShareButtons&&1==r.showShareButtons?r.showShareButtons=!1:r.showShareButtons=!0},r.initController=function(){o.loading=!0,t.GetPageWithPosts(i.id).then(function(e){if("200"==e.status&&e.data&&e.data.page){o.metaservice=c,o.metaservice.set(e.data.page.title,e.data.page.description,!!e.data.page.profilePic&&e.data.page.profilePic);var t=n.search();t&&"true"==t.success&&s.Success("Your page is now Live."),r.pageData=e.data.page,r.title=e.data.page.title,r.postData=e.data.posts,o.visitedSearchPage=!0,o.adPosts.data=[];for(var a=0;a<e.data.length;a++)o.adPosts.data.push(e.data[a]);o.refreshAds(),o.loading=!1}else l.dataLoading=!1,n.path("/"),o.loading=!1})},r.subscribe=function(){o.subscribePageId=i.id,o.modalInstance=a.open({templateUrl:"app-view/subscribe/SubscribePageView.html"})},r.reportPage=function(){o.subscribePageId=i.id,o.modalInstance=a.open({templateUrl:"app-view/report/ReportView.html"})}}]),app.filter("startFrom",function(){return function(e,t){return t=+t,e?e.slice(t):0}}),app.filter("roundup",function(){return function(e){return Math.ceil(e)}}),app.controller("AdsController",["$scope","$rootScope","$location","HttpService","$window",function(e,a,r,t,o){var n={};a.savedPreference=o.localStorage.getItem("healthyfling_preference"),"locked"==a.savedPreference&&(a.search.country=o.localStorage.getItem("healthyfling_preference_country")||"Country",a.search.state=o.localStorage.getItem("healthyfling_preference_state")||"State",a.search.region=o.localStorage.getItem("healthyfling_preference_region")||"Region",a.search.category=o.localStorage.getItem("healthyfling_preference_category")||"Category"),e.savedPreference="locked"==a.savedPreference,n.savedPreference="locked"==a.savedPreference,n.country=a.search.country,n.state=a.search.state,n.region=a.search.region,n.category=a.search.category,a.loading=!0,a.currentPost={},a.viewDetail=function(e){a.currentPost.data=e,r.path("/detail/"+e._id)},a.refreshAds=function(){t.GetPagePosts().then(function(e){if("200"==e.status){a.adPosts.data=[],"Region"!=a.search.region&&""!=a.search.region?a.pageTitle=a.search.region:a.pageTitle="All Regions";for(var t=0;t<e.data.length;t++)a.adPosts.data.push(e.data[t]);a.loading=!1}else a.loading=!1,n.dataLoading=!1,r.path("/")}),e.data=a.adPosts.data.reverse()}}]),app.controller("MediaController",["$rootScope","$scope","$location","HttpService","$window","FlashService","$modal","$routeParams","MetaService",function(o,r,n,t,e,s,a,i,c){var l=this;r.diffDate=function(e){var t=new Date(e),a=new Date,r=Math.abs(a.getTime()-t.getTime());return Math.ceil(r/864e5)},r.likePage=function(e){if(!o.isLoggedIn)return alert("You need to be logged in!");window.localStorage.getItem(e)||(window.localStorage.setItem(e,!0),t.LikePage(e).then(function(e){r.pageData.like=r.pageData.like+1}))},r.dislikePage=function(e){if(!o.isLoggedIn)return alert("You need to be logged in!");window.localStorage.getItem(e)||(window.localStorage.setItem(e,!0),t.DislikePage(e).then(function(e){r.pageData.dislike=r.pageData.dislike+1}))},r.messageModal=function(){o.modalInstance=a.open({templateUrl:"app-view/reply/ReplyView.html"})},r.currentPath=n.absUrl(),r.countries=o.countryList,r.states=o.stateList,r.regions=o.regionList,o.savedPreference=e.localStorage.getItem("healthyfling_preference"),"locked"==o.savedPreference&&(o.search.country=e.localStorage.getItem("healthyfling_preference_country")||"Country",o.search.state=e.localStorage.getItem("healthyfling_preference_state")||"State",o.search.region=e.localStorage.getItem("healthyfling_preference_region")||"Region",o.search.category=e.localStorage.getItem("healthyfling_preference_category")||"Category"),r.savedPreference="locked"==o.savedPreference,l.savedPreference="locked"==o.savedPreference,r.regions&&-1==r.regions.indexOf("Region")&&r.regions.unshift("Region"),r.categories=o.categoryList,r.changeListInCtrl=function(e){if(""!=e&&null!=e&&"State"!=e&&"Provinces"!=e){o.regionList=o.masterList[e],r.regions=o.regionList,r.regions.unshift("Region");var a=r.regions;r.regions=a.filter(function(e,t){return a.indexOf(e)==t})}else"United States"!=l.country&&"Canada"!=l.country||(r.regions=["Region"])},r.changeStateListInCtrl=function(e){if(""!=e&&null!=e&&"Country"!=e)if(o.masterList=o.masterListAll[e],o.stateList=Object.keys(o.masterListAll[e]),r.states=o.stateList,"United States"!=e&&"Canada"!=e){o.regionList=o.masterList.State,r.regions=o.regionList,r.regions.unshift("Region");var a=r.regions;r.regions=a.filter(function(e,t){return a.indexOf(e)==t})}else"Canada"==e&&(l.state="Provinces")},o.loading=!0,o.adPosts={};var g=n.search();l.currentPage=g.page||0,l.pageSize=100,l.country=o.search.country||"Country",l.state=o.search.state||"State",l.region=o.search.region||"Region",l.category=o.search.category||"Category",l.post=function(){n.path("/post")},l.pages=function(){l.dataLoading=!0,n.path("/pages")},l.login=function(){o.modalInstance=a.open({templateUrl:"app-view/login/LoginView.html"})},l.logout=function(){l.dataLoading=!0,e.localStorage.removeItem("token"),n.path("/"),window.location.reload()},l.lockPreference=function(){e.localStorage.setItem("healthyfling_preference","locked"),e.localStorage.setItem("healthyfling_preference_country",l.country),e.localStorage.setItem("healthyfling_preference_state",l.state),e.localStorage.setItem("healthyfling_preference_region",l.region),e.localStorage.setItem("healthyfling_preference_category",l.category),o.savedPreference=!0,l.savedPreference=!0,r.savedPreference="locked",s.Success("Search preference saved for easier browsing.")},l.unlockPreference=function(){e.localStorage.setItem("healthyfling_preference","unlocked"),l.country=o.search.country="Country",l.state=o.search.state="State",l.region=o.search.region="Region",l.category=o.search.category="Category",o.savedPreference=!1,l.savedPreference=!1,r.savedPreference="unlocked",s.Success("Search preference has been deleted.")},l.search=function(){o.loading=!0,o.search.country=this.country,o.search.state=this.state,o.search.region=this.region,o.search.category=this.category,n.path("/search")},l.searchFilter=function(e,t,a,r){"Country"==e&&"State"==t&&"Region"==a||(o.loading=!0,o.search.country=e,o.search.state=t,o.search.region=a,o.search.category=r,n.path("/search"))},l.searchAll=function(){o.savedPreference=e.localStorage.getItem("healthyfling_preference"),"locked"==o.savedPreference?(o.search.country=e.localStorage.getItem("healthyfling_preference_country")||"Country",o.search.state=e.localStorage.getItem("healthyfling_preference_state")||"State",o.search.region=e.localStorage.getItem("healthyfling_preference_region")||"Region",o.search.category=e.localStorage.getItem("healthyfling_preference_category")||"Category",l.country=o.search.country||"Country",l.state=o.search.state||"State",l.region=o.search.region||"Region",l.category=o.search.category||"Category"):(l.country="Country",l.state="State",l.region="Region",l.category="Category",o.search.country=l.country,o.search.state=l.state,o.search.region=l.region,o.search.category=l.category),o.loading=!0,t.GetAllPosts().then(function(e){if("200"==e.status){o.adPosts.data=[];for(var t=0;t<e.data.length;t++)o.adPosts.data.push(e.data[t]);o.refreshAds(),o.loading=!1}else l.dataLoading=!1,n.path("/"),o.loading=!1})},l.searchFilter=function(e,t,a,r){"Country"==e&&"State"==t&&"Region"==a||(o.search.country=e,l.country=e,o.search.state=t,l.state=t,o.search.region=a,l.region=a,o.search.category=r,l.category=r,this.reloadSearch())},l.reloadSearch=function(){o.loading=!0,t.GetPosts().then(function(e){if("200"==e.status){o.adPosts.data=[];for(var t=0;t<e.data.length;t++)o.adPosts.data.push(e.data[t]);o.refreshAds(),o.loading=!1}else l.dataLoading=!1,n.path("/"),o.loading=!1})},l.nextPage=function(){l.currentPage=l.currentPage+1,n.search("page",l.currentPage)},l.prevPage=function(){l.currentPage=l.currentPage-1,n.search("page",l.currentPage)},r.params=n.search(),r.toggleShareButton=function(){r.showShareButtons&&1==r.showShareButtons?r.showShareButtons=!1:r.showShareButtons=!0},r.initController=function(){o.loading=!0,t.GetPageWithPosts(i.id).then(function(e){if("200"==e.status&&e.data&&e.data.page){o.metaservice=c,o.metaservice.set(e.data.page.title,e.data.page.description,!!e.data.page.profilePic&&e.data.page.profilePic);var t=n.search();t&&"true"==t.success&&s.Success("Your page is now Live."),r.pageData=e.data.page,r.title=e.data.page.title,r.postData=e.data.posts,r.gallery=[],r.postData.map(function(t){t&&(t.files.map(function(e){e&&r.gallery.push({image:e.secure_url,_id:e._id,postId:t._id})}),t.embed&&r.gallery.push({video:!0,postId:t._id}))}),o.visitedSearchPage=!0,o.adPosts.data=[];for(var a=0;a<e.data.length;a++)o.adPosts.data.push(e.data[a]);o.refreshAds(),o.loading=!1}else l.dataLoading=!1,n.path("/"),o.loading=!1})},r.subscribe=function(){o.subscribePageId=i.id,o.modalInstance=a.open({templateUrl:"app-view/subscribe/SubscribePageView.html"})},r.reportPage=function(){o.subscribePageId=i.id,o.modalInstance=a.open({templateUrl:"app-view/report/ReportView.html"})}}]),app.filter("startFrom",function(){return function(e,t){return t=+t,e?e.slice(t):0}}),app.filter("roundup",function(){return function(e){return Math.ceil(e)}}),app.controller("AdsController",["$scope","$rootScope","$location","HttpService","$window",function(e,a,r,t,o){var n={};a.savedPreference=o.localStorage.getItem("healthyfling_preference"),"locked"==a.savedPreference&&(a.search.country=o.localStorage.getItem("healthyfling_preference_country")||"Country",a.search.state=o.localStorage.getItem("healthyfling_preference_state")||"State",a.search.region=o.localStorage.getItem("healthyfling_preference_region")||"Region",a.search.category=o.localStorage.getItem("healthyfling_preference_category")||"Category"),e.savedPreference="locked"==a.savedPreference,n.savedPreference="locked"==a.savedPreference,n.country=a.search.country,n.state=a.search.state,n.region=a.search.region,n.category=a.search.category,a.loading=!0,a.currentPost={},a.viewDetail=function(e){a.currentPost.data=e,r.path("/detail/"+e._id)},a.refreshAds=function(){t.GetPagePosts().then(function(e){if("200"==e.status){a.adPosts.data=[],"Region"!=a.search.region&&""!=a.search.region?a.pageTitle=a.search.region:a.pageTitle="All Regions";for(var t=0;t<e.data.length;t++)a.adPosts.data.push(e.data[t]);a.loading=!1}else a.loading=!1,n.dataLoading=!1,r.path("/")}),e.data=a.adPosts.data.reverse()}}]),app.controller("ContactController",["$rootScope","$scope","$location","HttpService","$window","FlashService",function(t,r,e,a,o,n){var s=this;t.pageTitle="Contact us",t.savedPreference=o.localStorage.getItem("healthyfling_preference"),"locked"==t.savedPreference&&(t.search.country=o.localStorage.getItem("healthyfling_preference_country")||"Country",t.search.state=o.localStorage.getItem("healthyfling_preference_state")||"State",t.search.region=o.localStorage.getItem("healthyfling_preference_region")||"Region",t.search.category=o.localStorage.getItem("healthyfling_preference_category")||"Category"),s.country=t.search.country||"Country",s.state=t.search.state||"State",s.region=t.search.region||"Region",s.category=t.search.category||"Category",r.countries=t.countryList,r.states=t.stateList,r.regions=t.regionList,r.regions&&-1==r.regions.indexOf("Region")&&r.regions.unshift("Region"),r.categories=t.categoryList,r.savedPreference="locked"==t.savedPreference,s.savedPreference="locked"==t.savedPreference,r.changeListInCtrl=function(e){if(""!=e&&null!=e&&"State"!=e&&"Provinces"!=e){t.regionList=t.masterList[e],r.regions=t.regionList,r.regions.unshift("Region");var a=r.regions;r.regions=a.filter(function(e,t){return a.indexOf(e)==t})}else"United States"!=s.country&&"Canada"!=s.country||(r.regions=["Region"])},r.changeStateListInCtrl=function(e){if(""!=e&&null!=e&&"Country"!=e)if(t.masterList=t.masterListAll[e],t.stateList=Object.keys(t.masterListAll[e]),r.states=t.stateList,"United States"!=e&&"Canada"!=e){t.regionList=t.masterList.State,r.regions=t.regionList,r.regions.unshift("Region");var a=r.regions;r.regions=a.filter(function(e,t){return a.indexOf(e)==t})}else"Canada"==e&&(s.state="Provinces")},s.lockPreference=function(){o.localStorage.setItem("healthyfling_preference","locked"),o.localStorage.setItem("healthyfling_preference_country",s.country),o.localStorage.setItem("healthyfling_preference_state",s.state),o.localStorage.setItem("healthyfling_preference_region",s.region),o.localStorage.setItem("healthyfling_preference_category",s.category),t.savedPreference=!0,s.savedPreference=!0,r.savedPreference="locked",n.Success("Search preference saved for easier browsing.")},s.unlockPreference=function(){o.localStorage.setItem("healthyfling_preference","unlocked"),s.country=t.search.country="Country",s.state=t.search.state="State",s.region=t.search.region="Region",s.category=t.search.category="Category",t.savedPreference=!1,s.savedPreference=!1,r.savedPreference="unlocked",n.Success("Search preference has been deleted.")},r.updateList=function(e){t.regionList=t.masterList[e],r.regions=t.regionList,r.regions.unshift("Region")},s.post=function(){e.path("/post")},s.pages=function(){s.dataLoading=!0,e.path("/pages")},s.login=function(){t.modalInstance=$modal.open({templateUrl:"app-view/login/LoginView.html"})},s.logout=function(){s.dataLoading=!0,o.localStorage.removeItem("token"),e.path("/"),window.location.reload()},s.search=function(){t.search.country="United States",t.search.state=this.state,t.search.region=this.region,t.search.category=this.category,e.path("/search")},s.post=function(){s.dataLoading=!0,e.path("/post")},s.search=function(){s.dataLoading=!0,e.path("/search")},r.notify=function(){if(r.showError=!0,r.showRequiredNameError=!1,r.showRequiredEmailError=!1,r.showRequiredSubjectError=!1,r.showRequiredMessageError=!1,r.showCaptchaError=!1,r.name||(r.showRequiredNameError=!0),r.email||(r.showRequiredEmailError=!0),r.subject||(r.showRequiredSubjectError=!0),r.message||(r.showRequiredMessageError=!0),r.captcha||(r.showCaptchaError=!0),r.showCaptchaError||r.showRequiredNameError||r.showRequiredEmailError||r.showRequiredSubjectError||r.showRequiredMessageError)o.scrollTo(0,0);else{t.loading=!0;var e={message:"Equiry Log: \n\n Name: "+r.name+"\nEnquiry: "+r.message+"\nEmail: "+r.email+"\n\n Regards, \n\n"+r.name,subject:"Received Request: "+r.subject,sender1:"info@healthyfling.com",from:r.email};r.showError=!1,a.SendMail(e).then(function(e){"200"==e.status||"250"==e.status?(t.loading=!1,n.Success("Your Contact submission went through, you will receive a response between 24 and 48 hours."),r.name="",r.message="",r.email="",r.subject="",r.captcha=""):(s.dataLoading=!1,t.loading=!1,n.Error("There was an error while submitting your request. Please try again."))})}}}]),app.controller("ResponseController",["$rootScope","$scope","$location","HttpService","$http",function(t,r,e,a,o){var n=this;t.pageTitle="Healthy Fling",r.countries=t.countryList,r.states=t.stateList,r.regions=t.regionList,r.regions&&-1==r.regions.indexOf("Region")&&r.regions.unshift("Region"),r.categories=t.categoryList,r.changeListInCtrl=function(e){if(""!=e&&null!=e&&"State"!=e&&"Provinces"!=e){t.regionList=t.masterList[e],r.regions=t.regionList,r.regions.unshift("Region");var a=r.regions;r.regions=a.filter(function(e,t){return a.indexOf(e)==t})}else"United States"!=n.country&&"Canada"!=n.country||(r.regions=["Region"])},r.changeStateListInCtrl=function(e){if(""!=e&&null!=e&&"Country"!=e)if(t.masterList=t.masterListAll[e],t.stateList=Object.keys(t.masterListAll[e]),r.states=t.stateList,"United States"!=e&&"Canada"!=e){t.regionList=t.masterList.State,r.regions=t.regionList,r.regions.unshift("Region");var a=r.regions;r.regions=a.filter(function(e,t){return a.indexOf(e)==t})}else"Canada"==e&&(n.state="Provinces")},r.updateList=function(e){t.regionList=t.masterList[e],r.regions=t.regionList,r.regions.unshift("Region")},n.post=function(){e.path("/post")},n.pages=function(){n.dataLoading=!0,e.path("/pages")},n.login=function(){t.modalInstance=$modal.open({templateUrl:"app-view/login/LoginView.html"})},n.logout=function(){n.dataLoading=!0,$window.localStorage.removeItem("token"),e.path("/"),window.location.reload()},n.search=function(){t.search.country="United States",t.search.state=this.state,t.search.region=this.region,t.search.category=this.category,e.path("/search")},n.post=function(){n.dataLoading=!0,e.path("/post")},n.search=function(){n.dataLoading=!0,e.path("/search")}}]),app.controller("DeleteController",["$rootScope","$scope","$location","HttpService","$http","$window","FlashService",function(r,o,a,n,s,e,t){var i=this;r.pageTitle="Healthy Fling",r.savedPreference=e.localStorage.getItem("healthyfling_preference"),"locked"==r.savedPreference&&(r.search.country=e.localStorage.getItem("healthyfling_preference_country")||"Country",r.search.state=e.localStorage.getItem("healthyfling_preference_state")||"State",r.search.region=e.localStorage.getItem("healthyfling_preference_region")||"Region",r.search.category=e.localStorage.getItem("healthyfling_preference_category")||"Category"),i.country=r.search.country||"Country",i.state=r.search.state||"State",i.region=r.search.region||"Region",i.category=r.search.category||"Category",o.countries=r.countryList,o.states=r.stateList,o.regions=r.regionList,o.regions&&-1==o.regions.indexOf("Region")&&o.regions.unshift("Region"),o.categories=r.categoryList,o.savedPreference="locked"==r.savedPreference,i.savedPreference="locked"==r.savedPreference,o.changeListInCtrl=function(e){if(""!=e&&null!=e&&"State"!=e&&"Provinces"!=e){r.regionList=r.masterList[e],o.regions=r.regionList,o.regions.unshift("Region");var a=o.regions;o.regions=a.filter(function(e,t){return a.indexOf(e)==t})}else"United States"!=i.country&&"Canada"!=i.country||(o.regions=["Region"])},o.changeStateListInCtrl=function(e){if(""!=e&&null!=e&&"Country"!=e)if(r.masterList=r.masterListAll[e],r.stateList=Object.keys(r.masterListAll[e]),o.states=r.stateList,"United States"!=e&&"Canada"!=e){r.regionList=r.masterList.State,o.regions=r.regionList,o.regions.unshift("Region");var a=o.regions;o.regions=a.filter(function(e,t){return a.indexOf(e)==t})}else"Canada"==e&&(i.state="Provinces")},i.lockPreference=function(){e.localStorage.setItem("healthyfling_preference","locked"),e.localStorage.setItem("healthyfling_preference_country",i.country),e.localStorage.setItem("healthyfling_preference_state",i.state),e.localStorage.setItem("healthyfling_preference_region",i.region),e.localStorage.setItem("healthyfling_preference_category",i.category),r.savedPreference=!0,i.savedPreference=!0,o.savedPreference="locked",t.Success("Search preference saved for easier browsing.")},i.unlockPreference=function(){e.localStorage.setItem("healthyfling_preference","unlocked"),i.country=r.search.country="Country",i.state=r.search.state="State",i.region=r.search.region="Region",i.category=r.search.category="Category",r.savedPreference=!1,i.savedPreference=!1,o.savedPreference="unlocked",t.Success("Search preference has been deleted.")},o.updateList=function(e){r.regionList=r.masterList[e],o.regions=r.regionList,o.regions.unshift("Region")},i.post=function(){a.path("/post")},i.pages=function(){i.dataLoading=!0,a.path("/pages")},i.login=function(){r.modalInstance=$modal.open({templateUrl:"app-view/login/LoginView.html"})},i.logout=function(){i.dataLoading=!0,e.localStorage.removeItem("token"),a.path("/"),window.location.reload()},i.search=function(){r.search.country="United States",r.search.state=this.state,r.search.region=this.region,r.search.category=this.category,a.path("/search")},i.post=function(){i.dataLoading=!0,a.path("/post")},i.search=function(){i.dataLoading=!0,a.path("/search")},o.initController=function(){s.get("/data.json").success(function(e){r.masterList=e});var e=a.path().split("/"),t=e[e.length-1];o.id=t,r.loading=!0,o.mainImage="https://placehold.it/710X420",n.DeleteAPost(t).then(function(e){"200"==e.status?(r.currentPost.data=e.data,r.regionList=r.masterList[e.data.state],o.regions=r.regionList,i.country="United States",i.state=e.data.state,i.region=e.data.region,i.category=e.data.category,o.id=r.currentPost.data._id,o.title=r.currentPost.data.title,r.pageTitle=o.title,o.message=r.currentPost.data.body,o.age=r.currentPost.data.age,o.location=r.currentPost.data.location,o.region=r.currentPost.data.region,o.sender1=r.currentPost.data.email,o.country="United States",o.state=r.currentPost.data.state,o.category=r.currentPost.data.category,o.created=r.currentPost.data.created,o.files=r.currentPost.data.files,r.loading=!1,0<o.files.length&&(o.mainImage=o.files[0].url)):(r.loading=!1,i.dataLoading=!1,a.path("/"))})},o.notify=function(){if(o.captcha)if(o.email){r.loading=!0;var e={htmlmessage:"<p>"+o.replymessage+"</p><p>"+a.absUrl().replace("reply","detail")+"</p><p><a href='mailto:"+o.email+"?subject=Re: "+o.title+"'>Reply to this message</a> </p> Regards, <br/>Healthyfling Team",subject:"Re: "+(o.title||o.message),sender1:o.sender1};n.SendMail(e).then(function(e){"200"==e.success||"250"==e.success?(r.loading=!1,alert("Email has been sent to the poster!")):(i.dataLoading=!1,r.loading=!1,alert("Email has been sent to the poster!"),a.path("/"))})}else alert("Email address is missing");else alert("Please accept the terms and condition.")}}]),app.controller("DetailController",["$rootScope","$scope","$location","HttpService","$http","$route","FlashService","$document","$modal","$window",function(o,i,n,a,r,e,s,t,c,l){var g=this;o.visitedSearchPage&&(o.loading=!0),i.replyNotified=!1,i.showShareButtons=!1,i.showEmbedButtons=!1,i.replyNotifiedEmail="",i.currentPath=n.absUrl(),i.embed="",i.commentembed="",i.comments=[],i.commentsMainImage=[],i.replyMainImage=[],o.savedPreference=l.localStorage.getItem("healthyfling_preference"),"locked"==o.savedPreference&&(o.search.country=l.localStorage.getItem("healthyfling_preference_country")||"Country",o.search.state=l.localStorage.getItem("healthyfling_preference_state")||"State",o.search.region=l.localStorage.getItem("healthyfling_preference_region")||"Region",o.search.category=l.localStorage.getItem("healthyfling_preference_category")||"Category"),g.country=o.search.country||"Country",g.state=o.search.state||"State",g.region=o.search.region||"Region",g.category=o.search.category||"Category",i.countries=o.countryList,i.states=o.stateList,i.regions=o.regionList||["REGION"],i.regions&&-1==i.regions.indexOf("Region")&&i.regions.unshift("Region"),i.categories=o.categoryList,i.savedPreference="locked"==o.savedPreference,g.savedPreference="locked"==o.savedPreference,i.changeListInCtrl=function(e){if(""!=e&&null!=e&&"State"!=e&&"Provinces"!=e){o.masterList=o.masterListAll[g.country],o.regionList=o.masterList[e],i.regions=o.regionList,i.regions.unshift("Region");var a=i.regions;i.regions=a.filter(function(e,t){return a.indexOf(e)==t})}else"United States"!=g.country&&"Canada"!=g.country||(i.regions=["Region"])},i.changeStateListInCtrl=function(e){if(""!=e&&null!=e&&"Country"!=e)if(o.masterList=o.masterListAll[e],o.stateList=Object.keys(o.masterListAll[e]),i.states=o.stateList,"United States"!=e&&"Canada"!=e){o.regionList=o.masterList.State,i.regions=o.regionList,i.regions.unshift("Region");var a=i.regions;i.regions=a.filter(function(e,t){return a.indexOf(e)==t})}else"Canada"==e&&(g.state="Provinces");else o.stateList=["State"],i.states=o.stateList},g.lockPreference=function(){l.localStorage.setItem("healthyfling_preference","locked"),l.localStorage.setItem("healthyfling_preference_country",g.country),l.localStorage.setItem("healthyfling_preference_state",g.state),l.localStorage.setItem("healthyfling_preference_region",g.region),l.localStorage.setItem("healthyfling_preference_category",g.category),o.savedPreference=!0,g.savedPreference=!0,i.savedPreference="locked",s.Success("Search preference saved for easier browsing.")},g.unlockPreference=function(){l.localStorage.setItem("healthyfling_preference","unlocked"),g.country=o.search.country="Country",g.state=o.search.state="State",g.region=o.search.region="Region",g.category=o.search.category="Category",o.savedPreference=!1,g.savedPreference=!1,i.savedPreference="unlocked",s.Success("Search preference has been deleted.")},o.imageList=[],i.addComment=function(e){if(i.showError=!0,"Age"==i.mage&&(i.mage=""),null==i.commentmessage&&""==i.commentmessage||null==i.captcha)s.Error("Please select the Capcha!"),l.scrollTo(0,0);else{i.showImageError=!1,o.loading=!0;var t={commentmessage:i.commentmessage,email:i.replyNotifiedEmail,commentfiles:o.imageList,commentembed:i.commentembed.replace("src=","xxx=").replace("href=","yyyy=")};a.EditPost(e,t).then(function(e){"200"==e.status?(e&&e.data&&e.data._id&&(n.path("/detail/"+e.data._id),s.Success("Your comment has been successfully added."),i.loadComments(i.id),i.commentmessage="",i.commentembed="",l.scrollTo(0,0)),o.loading=!1,o.imageList=[],i.commentsMainImage=[],i.replyMainImage=[],i.comments=[]):(o.loading=!1,g.dataLoading=!1,n.path("/"))})}},i.replyComment=function(e){},i.changeMainImage=function(e,t){i.mainImage=0==t?e.secure_url:e},i.changeCommentsMainImage=function(e,t){i.commentsMainImage[t]=e},i.changeReplyMainImage=function(e,t,a){i.replyMainImage[t][a]=e};var d=n.path().split("/"),h=d[d.length-1];i.id=h,i.loadComments=function(e){i.commentsMainImage=[],i.replyMainImage=[],i.comments=[];var s=[];a.GetComments(e).then(function(e){if("200"==e.status)for(var t=0;t<e.data.length;t++){var a=e.data[t];a.embed&&(a.embed=a.embed.replace("xxx=","src=").replace("yyyy=","href=")),null!=a&&0<a.files.length?a.mainImage=a.files[0].secure_url:null!=a&&""!=a.embed&&0==a.files.length&&(a.mainImage=a.embed),a.replies.reverse(),s=[];for(var r=0;r<a.replies.length;r++){if(null!=a.replies[r].label){var o=i.findIndexByKeyValue(a.replies,"_id",a.replies[r].label);if(-1<o){var n=a.replies[o].owner;a.replies[r].responseLabel="poster"==n?'(Response to "Reply '+(o+1)+' posters response")':'(Response to "Reply '+(o+1)+'")'}}null!=a.replies[r].embed&&""!=a.replies[r].embed?a.replies[r].embed=a.replies[r].embed.replace("xxx=","src=").replace("yyyy=","href="):a.replies[r].embed="",null!=a.replies[r]&&0<a.replies[r].files.length?a.replies[r].mainImage=a.replies[r].files[0].secure_url:null!=a.replies[r]&&""!=a.replies[r].embed&&0==a.replies[r].files.length&&(a.replies[r].mainImage=a.replies[r].embed),s.push(a.replies[r].mainImage)}i.replyMainImage.push(s),i.commentsMainImage.push(a.mainImage),i.comments.push(a)}})},i.findIndexByKeyValue=function(e,t,a){for(var r=0;r<e.length;r++)if(e[r][t]==a)return r;return-1},i.deleteComment=function(e){o.loading=!0,a.DeleteAComment(e).then(function(e){"200"==e.status?(i.loadComments(i.id),s.Success("The comment has been successfully deleted."),o.loading=!1,l.scrollTo(0,0)):o.loading=!1})},i.deleteReply=function(e){o.loading=!0,a.DeleteAReply(e).then(function(e){"200"==e.status?(i.loadComments(i.id),s.Success("The reply has been successfully deleted."),o.loading=!1,l.scrollTo(0,0)):o.loading=!1})},i.flagComment=function(e){o.loading=!0,a.FlagAComment(e).then(function(e){"200"==e.status?(i.loadComments(i.id),s.Success("The comment has been successfully flagged."),o.loading=!1,l.scrollTo(0,0)):o.loading=!1})},i.unflagComment=function(e){o.loading=!0,a.UnflagAComment(e).then(function(e){"200"==e.status?(i.loadComments(i.id),s.Success("The comment has been successfully unflagged."),o.loading=!1,l.scrollTo(0,0)):o.loading=!1})},i.initController=function(){r.get("/data_country.json").success(function(e){o.masterListAll=e}),o.is_flagged=!1,g.country=o.search.country,g.state=o.search.state,g.region=o.search.region,g.category=o.search.category,i.comments=[];var e=n.path().split("/"),t=e[e.length-1];i.id=t,o.visitedSearchPage&&(o.loading=!0),i.mainImage="https://placehold.it/710X420",a.GetAPost(t).then(function(e){if(i.is_edit=!1,"200"==e.status&&e.data._id){o.currentPost.data=e.data;var t=n.search();t&&"true"==t.success?s.Success("Your post is now Live."):t&&"true"==t.edit?i.is_edit=!0:-1<n.url().indexOf("msg=true")&&s.Success("You have successfully replied to this post, you may or may not get a response from this poster."),g.country=e.data.country||"United States",o.masterList=o.masterListAll[g.country],o.regionList=o.masterList[e.data.state],i.regions=o.regionList,g.state=e.data.state,g.region=e.data.region,g.category=e.data.category,i.title=o.currentPost.data.title,o.pageTitle=i.title,i.post_id=o.currentPost.data._id,i.message=o.currentPost.data.body,i.message=i.message.replace(/[\r\n]/g,"<br/>"),i.age=o.currentPost.data.age,i.region=o.currentPost.data.region,i.location=o.currentPost.data.location,i.sender1=o.currentPost.data.email,i.country=o.currentPost.data.country||"United States",i.state=o.currentPost.data.state,i.category=o.currentPost.data.category,i.created=o.currentPost.data.created,i.expires=new Date(o.currentPost.data.created),i.expires.setDate(i.expires.getDate()+8),i.files=o.currentPost.data.files,i.haircolor=o.currentPost.data.haircolo,i.height=o.currentPost.data.height,i.ethnicity=o.currentPost.data.ethnicity,i.orientation=o.currentPost.data.orientation,i.bodytype=o.currentPost.data.bodytype,i.eyecolor=o.currentPost.data.eyecolor,i.mstatus=o.currentPost.data.mstatus,i.gender=o.currentPost.data.gender,i.bodyhair=o.currentPost.data.bodyhair,i.hivstatus=o.currentPost.data.hivstatus,i.weight=o.currentPost.data.weight,i.mage=o.currentPost.data.mage,i.anonymouscomment=o.currentPost.data.anonymouscomment||"disabled",i.embed=o.currentPost.data.embed.replace("xxx=","src=").replace("yyyy=","href=")||"",i.share=o.currentPost.data.share||"disabled",o.loading=!1,0<i.files.length?i.mainImage=i.files[0].secure_url:""!=i.embed&&0==i.files.length&&(i.mainImage=i.embed)}else o.loading=!1,g.dataLoading=!1,n.path("/expired")}),i.loadComments(t)},o.reloadPost=function(){g.state=o.currentPost.data.body},g.post=function(){n.path("/post")},g.search=function(){o.loading=!0,o.search.country=this.country,o.search.state=this.state,o.search.region=this.region,o.search.category=this.category,n.path("/search")},g.searchFilter=function(e,t,a,r){"Country"==e&&"State"==t&&"Region"==a||(o.loading=!0,o.search.country=e,o.search.state=t,o.search.region=a,o.search.category=r,n.path("/search"))},i.notify=function(){if(i.showEmail=!0,i.showEmail&&i.sender2&&0<i.sender2.length){o.loading=!0;var e={message:"Perfect match found for both of you.",subject:"We need to put in a subject",sender1:i.sender1,sender2:i.sender2,link:n.$$absUrl};a.SendMail(e).then(function(e){"200"==e.success||"250"==e.success?(o.loading=!1,alert("Email has been sent to the poster!")):(g.dataLoading=!1,o.loading=!1,alert("Email has been sent to the poster!"),n.path("/"))})}},i.toggleReplyNotify=function(){i.replyNotified&&1==i.replyNotified?(i.replyNotified=!1,i.replyNotifiedEmail=""):i.replyNotified=!0},i.toggleEmbedButton=function(){i.showEmbedButtons&&1==i.showEmbedButtons?i.showEmbedButtons=!1:i.showEmbedButtons=!0},i.toggleShareButton=function(){i.showShareButtons&&1==i.showShareButtons?i.showShareButtons=!1:i.showShareButtons=!0},i.openModal=function(){o.modalInstance=c.open({templateUrl:"app-view/reply/ReplyView.html"})},i.openModal_flag=function(){o.modalInstance=c.open({templateUrl:"app-view/flag/FlagView.html"})},i.openCommentModal=function(e,t){o.comment=e,o.comment.replyLabel=t._id,"poster"==t.owner&&"yes"==o.currentPost.data.notified?o.comment.replyEmail=o.currentPost.data.email||"":o.comment.replyEmail=t.email||"",o.comment.ownerEmail=o.currentPost.data.email,o.modalInstance=c.open({templateUrl:"app-view/comment/CommentView.html"})},i.openCommentModalPoster=function(e,t){o.comment=e,o.comment.replyLabel=t._id,o.comment.replyEmail=t.email||"",o.comment.ownerEmail=o.currentPost.data.email,o.comment.owner="poster",o.modalInstance=c.open({templateUrl:"app-view/comment/CommentView.html"})},i.openCommentsModal_flag=function(e){o.comment_to_flag=e,o.modalInstance=c.open({templateUrl:"app-view/options/OptionsView.html"})},i.openReplyModal_flag=function(e){o.reply_to_flag=e,o.modalInstance=c.open({templateUrl:"app-view/options/OptionsView.html"})},i.unflagReply=function(e){o.loading=!0,a.UnflagAReply(e).then(function(e){"200"==e.status?(i.loadComments(i.id),s.Success("The comment has been successfully unflagged."),o.loading=!1,l.scrollTo(0,0)):o.loading=!1})},i.$on("reloadComments",function(){i.loadComments(i.id)}),i.deleteImage=function(e){o.imageList.splice(e,1),i.files=o.imageList},i.stopLoader=function(){o.loadingImage=!1}}]),app.controller("ExpiredController",["$rootScope","$scope","$location","HttpService","$http","$window","FlashService","MetaService",function(t,r,e,a,o,n,s,i){var c=this;t.metaservice=i,t.metaservice.set(),t.savedPreference=n.localStorage.getItem("healthyfling_preference"),"locked"==t.savedPreference&&(t.search.country=n.localStorage.getItem("healthyfling_preference_country")||"Country",t.search.state=n.localStorage.getItem("healthyfling_preference_state")||"State",t.search.region=n.localStorage.getItem("healthyfling_preference_region")||"Region",t.search.category=n.localStorage.getItem("healthyfling_preference_category")||"Category"),c.country=t.search.country||"Country",c.state=t.search.state||"State",c.region=t.search.region||"Region",c.category=t.search.category||"Category",r.countries=t.countryList,r.states=t.stateList,r.regions=t.regionList,r.regions&&-1==r.regions.indexOf("Region")&&r.regions.unshift("Region"),r.categories=t.categoryList,r.savedPreference="locked"==t.savedPreference,c.savedPreference="locked"==t.savedPreference,r.changeListInCtrl=function(e){if(""!=e&&null!=e&&"State"!=e&&"Provinces"!=e){t.regionList=t.masterList[e],r.regions=t.regionList,r.regions.unshift("Region");var a=r.regions;r.regions=a.filter(function(e,t){return a.indexOf(e)==t})}else"United States"!=c.country&&"Canada"!=c.country||(r.regions=["Region"])},r.changeStateListInCtrl=function(e){if(""!=e&&null!=e&&"Country"!=e)if(t.masterList=t.masterListAll[e],t.stateList=Object.keys(t.masterListAll[e]),r.states=t.stateList,"United States"!=e&&"Canada"!=e){t.regionList=t.masterList.State,r.regions=t.regionList,r.regions.unshift("Region");var a=r.regions;r.regions=a.filter(function(e,t){return a.indexOf(e)==t})}else"Canada"==e&&(c.state="Provinces")},c.lockPreference=function(){n.localStorage.setItem("healthyfling_preference","locked"),n.localStorage.setItem("healthyfling_preference_country",c.country),n.localStorage.setItem("healthyfling_preference_state",c.state),n.localStorage.setItem("healthyfling_preference_region",c.region),n.localStorage.setItem("healthyfling_preference_category",c.category),t.savedPreference=!0,c.savedPreference=!0,r.savedPreference="locked",s.Success("Search preference saved for easier browsing.")},c.unlockPreference=function(){n.localStorage.setItem("healthyfling_preference","unlocked"),c.country=t.search.country="Country",c.state=t.search.state="State",c.region=t.search.region="Region",c.category=t.search.category="Category",t.savedPreference=!1,c.savedPreference=!1,r.savedPreference="unlocked",s.Success("Search preference has been deleted.")},r.updateList=function(e){t.regionList=t.masterList[e],r.regions=t.regionList,r.regions.unshift("Region")},c.post=function(){e.path("/post")},c.pages=function(){c.dataLoading=!0,e.path("/pages")},c.login=function(){t.modalInstance=$modal.open({templateUrl:"app-view/login/LoginView.html"})},c.logout=function(){c.dataLoading=!0,n.localStorage.removeItem("token"),e.path("/"),window.location.reload()},c.search=function(){t.search.country="United States",t.search.state=this.state,t.search.region=this.region,t.search.category=this.category,e.path("/search")},c.post=function(){c.dataLoading=!0,e.path("/post")},c.search=function(){c.dataLoading=!0,e.path("/search")}}]),app.controller("ErrorController",["$rootScope","$scope","$location","HttpService","$http",function(t,r,e,a,o){var n=this;t.pageTitle="Healthy Fling",r.countries=t.countryList,r.states=t.stateList,r.regions=t.regionList,r.regions&&-1==r.regions.indexOf("Region")&&r.regions.unshift("Region"),r.categories=t.categoryList,r.changeListInCtrl=function(e){if(""!=e&&null!=e&&"State"!=e&&"Provinces"!=e){t.regionList=t.masterList[e],r.regions=t.regionList,r.regions.unshift("Region");var a=r.regions;r.regions=a.filter(function(e,t){return a.indexOf(e)==t})}else"United States"!=n.country&&"Canada"!=n.country||(r.regions=["Region"])},r.changeStateListInCtrl=function(e){if(""!=e&&null!=e&&"Country"!=e)if(t.masterList=t.masterListAll[e],t.stateList=Object.keys(t.masterListAll[e]),r.states=t.stateList,"United States"!=e&&"Canada"!=e){t.regionList=t.masterList.State,r.regions=t.regionList,r.regions.unshift("Region");var a=r.regions;r.regions=a.filter(function(e,t){return a.indexOf(e)==t})}else"Canada"==e&&(n.state="Provinces")},r.updateList=function(e){t.regionList=t.masterList[e],r.regions=t.regionList,r.regions.unshift("Region")},n.post=function(){e.path("/post")},n.pages=function(){n.dataLoading=!0,e.path("/pages")},n.login=function(){t.modalInstance=$modal.open({templateUrl:"app-view/login/LoginView.html"})},n.logout=function(){n.dataLoading=!0,$window.localStorage.removeItem("token"),e.path("/"),window.location.reload()},n.search=function(){t.search.country="United States",t.search.state=this.state,t.search.region=this.region,t.search.category=this.category,e.path("/search")},n.post=function(){n.dataLoading=!0,e.path("/post")},n.search=function(){n.dataLoading=!0,e.path("/search")}}]),app.controller("ReplyController",["$rootScope","$scope","$location","HttpService","$http","$window","FlashService","$modal",function(r,o,n,s,e,i,c,t){var l=this;o.location=n.path(),o.arr=o.location.split("/"),o.page=o.arr[1],o.id=o.arr[o.arr.length-1],o.states=r.stateList,o.regions=r.regionList,o.regions&&-1==o.regions.indexOf("Region")&&o.regions.unshift("Region"),o.categories=r.categoryList,o.changeListInCtrl=function(e){if(""!=e&&null!=e&&"State"!=e&&"Provinces"!=e){r.regionList=r.masterList[e],o.regions=r.regionList,o.regions.unshift("Region");var a=o.regions;o.regions=a.filter(function(e,t){return a.indexOf(e)==t})}else"United States"!=l.country&&"Canada"!=l.country||(o.regions=["Region"])},o.changeStateListInCtrl=function(e){if(""!=e&&null!=e&&"Country"!=e)if(r.masterList=r.masterListAll[e],r.stateList=Object.keys(r.masterListAll[e]),o.states=r.stateList,"United States"!=e&&"Canada"!=e){r.regionList=r.masterList.State,o.regions=r.regionList,o.regions.unshift("Region");var a=o.regions;o.regions=a.filter(function(e,t){return a.indexOf(e)==t})}else"Canada"==e&&(l.state="Provinces")},o.updateList=function(e){r.regionList=r.masterList[e],o.regions=r.regionList,o.regions.unshift("Region")},r.tempImageList=[],o.replyfiles=[],o.stopLoader=function(){r.loadingImage=!1},o.deleteImage=function(e){r.tempImageList.splice(e,1),o.replyfiles=r.tempImageList},l.post=function(){n.path("/post")},l.pages=function(){l.dataLoading=!0,n.path("/pages")},l.login=function(){r.modalInstance=t.open({templateUrl:"app-view/login/LoginView.html"})},l.logout=function(){l.dataLoading=!0,i.localStorage.removeItem("token"),n.path("/"),window.location.reload()},l.search=function(){r.search.state=this.state,r.search.region=this.region,r.search.category=this.category,n.path("/search")},l.post=function(){l.dataLoading=!0,n.path("/post")},l.search=function(){l.dataLoading=!0,n.path("/search")},o.initController=function(){e.get("/data.json").success(function(e){r.masterList=e}),o.mainImage="https://placehold.it/710X420","detail"===o.page?s.GetAPost(o.id).then(function(e){"200"==e.status?(r.currentPost.data=e.data,l.state=e.data.state,l.region=e.data.region,l.category=e.data.category,o.id=r.currentPost.data._id,o.title=r.currentPost.data.title,r.pageTitle=o.title,o.message=r.currentPost.data.body,o.age=r.currentPost.data.age,o.location=r.currentPost.data.location,o.region=r.currentPost.data.region,o.sender1=r.currentPost.data.email,o.state=r.currentPost.data.state,o.category=r.currentPost.data.category,o.created=r.currentPost.data.created,o.files=r.currentPost.data.files,r.loading=!1,0<o.files.length&&(o.mainImage=o.files[0].secure_url)):(r.loading=!1,l.dataLoading=!1,n.path("/"))}):s.GetPageWithPosts(o.id).then(function(e){"200"==e.status&&e.data&&e.data.page?(o.title=e.data.page.title,o.sender1=e.data.page.email,r.loading=!1):(r.loading=!1,l.dataLoading=!1,n.path("/"))})},o.notify=function(){if(o.imageLength=0,o.showError=!0,o.showRequiredEmailError=!1,o.showRequiredReplyMessageError=!1,o.showEmailError=!1,o.showImageError=!1,o.showCaptchaError=!1,r.tempImageList&&5<r.tempImageList.length&&(o.showImageError=!0,o.imageLength=r.tempImageList.length),o.email||(o.showRequiredEmailError=!0),o.replymessage||(o.showRequiredReplyMessageError=!0),o.captcha||(o.showCaptchaError=!0),o.email!=o.confirmemail&&(o.showEmailError=!0),o.showCaptchaError||o.showRequiredEmailError||o.showRequiredReplyMessageError||o.showEmailError)i.scrollTo(0,0);else if(o.closeModal(),"detail"===o.page){c.Success("You have successfully replied to this post, you may or may not get a response from this poster.");var e={timeZone:"America/New_York"},t=new Date,a={htmlmessage:"<p>"+o.replymessage+"</p><p><b>You can respond by replying directly to this email!</b></p><p>Original Post:</p><p>"+n.absUrl().replace("reply","detail")+"</p> Regards, <br/>Healthyfling Team<p>If you feel this message is spam or an advertisement, you can always block or report this email through your email provider. If this message is illegal or associated with anything illegal, PLEASE CONTACT THE AUTHORITIES!</p>",subject:"[HealthyFling] RE: "+(o.title||o.message)+" - "+t.toLocaleString("en-US",e)+" ET",sender1:o.sender1,attachments:r.tempImageList,"x-from":o.email,"x-post-id":o.id};o.showError=!1,s.SendMail(a).then(function(e){"200"==e.status||"250"==e.status?(r.loading=!1,r.loading=!1):(l.dataLoading=!1,r.loading=!1,c.Error("There was an error while submitting your request. Please try again."))})}else{c.Success("You have successfully messaged to this page, you may or may not get a response from this page owner.");e={timeZone:"America/New_York"},t=new Date,a={htmlmessage:"<p>"+o.replymessage+"</p><p><b>You can respond by replying directly to this email!</b></p><p>Original Page:</p><p>"+n.absUrl()+"</p> Regards, <br/>Healthyfling Team<p>If you feel this message is spam or an advertisement, you can always block or report this email through your email provider. If this message is illegal or associated with anything illegal, PLEASE CONTACT THE AUTHORITIES!</p>",subject:"[HealthyFling] RE: "+(o.title||o.message)+" - "+t.toLocaleString("en-US",e)+" ET",sender1:o.sender1,attachments:r.tempImageList,"x-from":o.email,"x-post-id":o.id};o.showError=!1,s.SendMail(a).then(function(e){"200"==e.status||"250"==e.status?(r.loading=!1,r.loading=!1):(l.dataLoading=!1,r.loading=!1,c.Error("There was an error while submitting your request. Please try again."))})}},o.closeModal=function(){r.modalInstance.close()}}]),app.controller("CommentController",["$rootScope","$scope","$location","HttpService","$http","$window","FlashService","$modal","$routeParams",function(r,o,a,n,s,i,c,e,l){var g=this;o.sendPostVerificationEmail=function(e){if(e){var t={email:e,postId:l.postId};n.ResendPostLink(t).then(function(e){"200"==e.status&&e.data&&e.data.sent?(c.Success("Email sent successfully!"),r.loading=!1,o.closeModal(),i.scrollTo(0,0)):(r.loading=!1,c.Error("There was an error while submitting your request. Please try again."),g.dataLoading=!1)})}},o.replyNotified=!1,o.showEmbedButtons=!1,o.replyNotifiedEmail="",o.replyembed="",o.states=r.stateList,o.regions=r.regionList,o.regions&&-1==o.regions.indexOf("Region")&&o.regions.unshift("Region"),o.categories=r.categoryList,o.changeListInCtrl=function(e){if(""!=e&&null!=e&&"State"!=e&&"Provinces"!=e){r.regionList=r.masterList[e],o.regions=r.regionList,o.regions.unshift("Region");var a=o.regions;o.regions=a.filter(function(e,t){return a.indexOf(e)==t})}else"United States"!=g.country&&"Canada"!=g.country||(o.regions=["Region"])},o.changeStateListInCtrl=function(e){if(""!=e&&null!=e&&"Country"!=e)if(r.masterList=r.masterListAll[e],r.stateList=Object.keys(r.masterListAll[e]),o.states=r.stateList,"United States"!=e&&"Canada"!=e){r.regionList=r.masterList.State,o.regions=r.regionList,o.regions.unshift("Region");var a=o.regions;o.regions=a.filter(function(e,t){return a.indexOf(e)==t})}else"Canada"==e&&(g.state="Provinces")},o.updateList=function(e){r.regionList=r.masterList[e],o.regions=r.regionList,o.regions.unshift("Region")},r.tempImageList=[],o.replyfiles=[],o.stopLoader=function(){r.loadingImage=!1},o.deleteImage=function(e){r.tempImageList.splice(e,1),o.replyfiles=r.tempImageList},g.post=function(){a.path("/post")},g.pages=function(){g.dataLoading=!0,a.path("/pages")},g.login=function(){r.modalInstance=e.open({templateUrl:"app-view/login/LoginView.html"})},g.logout=function(){g.dataLoading=!0,i.localStorage.removeItem("token"),a.path("/"),window.location.reload()},g.search=function(){r.search.state=this.state,r.search.region=this.region,r.search.category=this.category,a.path("/search")},g.post=function(){g.dataLoading=!0,a.path("/post")},g.search=function(){g.dataLoading=!0,a.path("/search")},o.initController=function(){o.commentMessage=r.comment.body,o.commentId=r.comment._id,o.commentLabel=r.comment.replyLabel,o.commentEmail=r.comment.replyEmail,o.commentOwner=r.comment.owner,o.ownerEmail=r.comment.ownerEmail,s.get("/data.json").success(function(e){r.masterList=e});var e=a.path().split("/"),t=e[e.length-1];o.id=t,o.mainImage="https://placehold.it/710X420",n.GetAPost(t).then(function(e){"200"==e.status?(r.currentPost.data=e.data,r.regionList=r.masterList[e.data.state],o.regions=r.regionList,g.state=e.data.state,g.region=e.data.region,g.category=e.data.category,o.id=r.currentPost.data._id,o.title=r.currentPost.data.title,r.pageTitle=o.title,o.message=r.currentPost.data.body,o.age=r.currentPost.data.age,o.location=r.currentPost.data.location,o.region=r.currentPost.data.region,o.sender1=r.currentPost.data.email,o.state=r.currentPost.data.state,o.category=r.currentPost.data.category,o.created=r.currentPost.data.created,o.files=r.currentPost.data.files,r.loading=!1,0<o.files.length&&(o.mainImage=o.files[0].secure_url)):(r.loading=!1,g.dataLoading=!1,a.path("/"))})},o.notify=function(e){if(o.imageLength=0,o.showError=!0,o.showRequiredReplyMessageError=!1,e||(o.showRequiredReplyMessageError=!0),o.showRequiredReplyMessageError)i.scrollTo(0,0);else{o.closeModal(),c.Success("You have successfully replied to this comment!"),r.loading=!0;var t={commentmessage:e,commentfiles:r.tempImageList,commentembed:o.replyembed.replace("src=","xxx=").replace("href=","yyyy="),commentemail:o.replyNotifiedEmail,label:o.commentLabel,owner:o.commentOwner,replyEmail:o.commentEmail};n.ReplyAComment(o.commentId,t).then(function(e){"200"==e.status?(c.Success("You have successfully replied to this comment!"),r.loading=!1,i.scrollTo(0,0),r.tempImageList=[],r.comment={},r.$broadcast("reloadComments")):(r.loading=!1,r.comment={})})}},o.toggleReplyNotify=function(){o.replyNotified&&1==o.replyNotified?(o.replyNotified=!1,o.replyNotifiedEmail=""):o.replyNotified=!0},o.toggleEmbedButton=function(){o.showEmbedButtons&&1==o.showEmbedButtons?o.showEmbedButtons=!1:o.showEmbedButtons=!0},o.closeModal=function(){r.comment={},r.modalInstance.close()}}]),app.controller("EditController",["$rootScope","$scope","$location","HttpService","$http","$window","MetaService",function(o,n,s,i,a,c,e){var l=this;o.metaservice=e,o.metaservice.set("Post an Ad"),n.countries=o.countryList,n.states=o.stateList,n.regions=o.regionList,n.newstates=["State"],n.newregions=[],n.imageUrl=[{}],n.addImageUrlField=function(){n.imageUrl.push({})},n.haircolorList=o.haircolorList,n.heightList=o.heightList,n.ethnicityList=o.ethnicityList,n.orientationList=o.orientationList,n.bodytypeList=o.bodytypeList,n.eyecolorList=o.eyecolorList,n.statusList=o.statusList,n.genderList=o.genderList,n.bodyHairList=o.bodyHairList,n.hivstatusList=o.hivstatusList,n.anonymouscommentList=["enabled","disabled"],n.notifiedList=["yes","no"];for(var t=["Age"],r=0;r<201;r++)t.push(r);n.ageRange=t,t=["Weight"];for(r=90;r<501;r++)t.push(r);n.weightRange=t,n.regions&&-1==n.regions.indexOf("Region")&&n.regions.unshift("Region"),n.categories=o.categoryList,l.state=o.search.state,l.region=o.search.region,l.category=o.search.category,o.imageList=[],n.changeListInCtrl=function(e){if(""!=e&&null!=e&&"State"!=e&&"Provinces"!=e){o.regionList=o.masterList[e],n.regions=o.regionList,n.regions.unshift("Region");var a=n.regions;n.regions=a.filter(function(e,t){return a.indexOf(e)==t})}else n.regions=["Region"]},n.changeStateListInCtrl=function(e){if(""!=e&&null!=e&&"Country"!=e)if(o.masterList=o.masterListAll[e],o.stateList=Object.keys(o.masterListAll[e]),n.states=o.stateList,"United States"!=e&&"Canada"!=e){o.regionList=o.masterList.State,n.regions=o.regionList,n.regions.unshift("Region");var a=n.regions;n.regions=a.filter(function(e,t){return a.indexOf(e)==t})}else"Canada"==e&&(l.state="Provinces")},n.changeNewPostList=function(e){if(""!=e&&null!=e&&"State"!=e&&"Provinces"!=e){n.newregions=n.newmasterList[e],n.newregions.unshift("Region");var a=n.newregions;n.newregions=a.filter(function(e,t){return a.indexOf(e)==t})}else n.newregions=["Region"]},n.changeNewPostStateList=function(e){if(""!=e&&null!=e&&"Country"!=e&&(n.newmasterList=o.masterListAll[e],n.newstates=Object.keys(o.masterListAll[e]),"United States"!=e&&"Canada"!=e)){n.newregions=n.newmasterList.State,n.newregions.unshift("Region");var a=n.newregions;n.newregions=a.filter(function(e,t){return a.indexOf(e)==t})}},n.stopLoader=function(){o.loadingImage=!1},n.deleteImage=function(e){o.imageList.splice(e,1),n.files=o.imageList},l.files=[],l.post=function(){s.path("/post")},l.pages=function(){l.dataLoading=!0,s.path("/pages")},l.login=function(){o.modalInstance=$modal.open({templateUrl:"app-view/login/LoginView.html"})},l.logout=function(){l.dataLoading=!0,c.localStorage.removeItem("token"),s.path("/"),window.location.reload()},l.check=function(){0<l.data.files.length&&alert(l.data.files.length+" files selected ... Max allowed files is 5.")},l.search=function(){o.search.state=this.state,o.search.region=this.region,o.search.category=this.category,s.path("/search")},l.data={title:"",country:"Country",state:"State",region:"Region",category:"Category",location:"",age:"",message:"",haircolor:"Hair Color",height:"Height",ethnicity:"Ethnicity",orientation:"Orientation",bodytype:"Body Type",eyecolor:"Eye Color",status:"Status",gender:"Gender",bodyhair:"Body Hair",hivstatus:"HIV Status",anonymouscomment:"disabled",notified:"no",share:"disabled",embed:"",weight:"Weight",mage:"Age"},n.editPost=function(e){if(n.showImageError=!1,n.showRequiredCountryError=!1,n.showRequiredStateError=!1,n.showRequiredRegionError=!1,n.showRequiredCategoryError=!1,n.showMessageError=!1,n.showTitleError=!1,n.showCaptchaError=!1,n.showError=!0,o.imageList&&10<o.imageList.length&&(n.showImageError=!0,n.imageLength=o.imageList.length),n.country&&"Country"!=n.country||(n.showRequiredCountryError=!0),n.state&&"State"!=n.state&&"Provinces"!=n.state||"United States"!=n.country&&"Canada"!=n.country||(n.showRequiredStateError=!0),n.region&&"Region"!=n.region||(n.showRequiredRegionError=!0),n.category&&"Category"!=n.category||(n.showRequiredCategoryError=!0),n.title||(n.showTitleError=!0),n.message||(n.showMessageError=!0),n.captcha||(n.showCaptchaError=!0),"Hair Color"==n.haircolor&&(n.haircolor=""),"Height"==n.height&&(n.height=""),"Ethnicity"==n.ethnicity&&(n.ethnicity=""),"Orientation"==n.orientation&&(n.orientation=""),"Body Type"==n.bodytype&&(n.bodytype=""),"Eye Color"==n.eyecolor&&(n.eyecolor=""),"Status"==n.mstatus&&(n.mstatus=""),"Gender"==n.gender&&(n.gender=""),"Body Hair"==n.bodyhair&&(n.bodyhair=""),"HIV Status"==n.hivstatus&&(n.hivstatus=""),"Weight"==n.weight&&(n.weight=""),"Age"==n.mage&&(n.mage=""),n.showRequiredStateError||n.showRequiredCountryError||n.showRequiredRegionError||n.showRequiredCategoryError||n.showMessageError||n.showImageError||n.showTitleError)c.scrollTo(0,0),""==n.mage&&(n.mage="Age"),""==n.haircolor&&(n.haircolor="Hair Color"),""==n.height&&(n.height="Height"),""==n.ethnicity&&(n.ethnicity="Ethnicity"),""==n.orientation&&(n.orientation="Orientation"),""==n.bodytype&&(n.bodytype="Body Type"),""==n.eyecolor&&(n.eyecolor="Eye Color"),""==n.mstatus&&(n.mstatus="Status"),""==n.gender&&(n.gender="Gender"),""==n.bodyhair&&(n.bodyhair="Body Hair"),""==n.hivstatus&&(n.hivstatus="HIV Status"),""==n.weight&&(n.weight="Weight");else{n.showImageError=!1,o.loading=!0;var t={title:n.title,country:n.country,state:n.state,region:n.region,category:n.category,location:n.location,age:n.age,message:n.message,haircolor:n.haircolor,height:n.height,ethnicity:n.ethnicity,orientation:n.orientation,bodytype:n.bodytype,eyecolor:n.eyecolor,mstatus:n.mstatus,gender:n.gender,bodyhair:n.bodyhair,hivstatus:n.hivstatus,anonymouscomment:n.anonymouscomment,notified:n.notified,embed:n.embed?n.embed.replace("src=","xxx=").replace("href=","yyyy="):"",share:n.share,city:n.city,zip:n.zip,weight:n.weight,mage:n.mage,files:o.imageList};i.EditPost(e,t).then(function(e){"200"==e.status?(e&&e.data&&e.data._id&&s.path("/detail/"+e.data._id),o.loading=!1):(o.loading=!1,l.dataLoading=!1,s.path("/"))})}},n.editPostPage=function(e){if(n.showImageError=!1,n.showMessageError=!1,n.showTitleError=!1,n.showCaptchaError=!1,n.showError=!0,o.imageList&&10<o.imageList.length&&(n.showImageError=!0,n.imageLength=o.imageList.length),n.title||(n.showTitleError=!0),n.message||(n.showMessageError=!0),n.captcha||(n.showCaptchaError=!0),n.showMessageError||n.showImageError||n.showTitleError)c.scrollTo(0,0);else{n.showImageError=!1,o.loading=!0,o.imageList=[],n.imageUrl&&n.imageUrl.map(function(e){o.imageList.push({secure_url:e.secure_url,resource_type:"imageURL",signature:e.signature||""})}),n.files.map(function(e){o.imageList.push({secure_url:e.secure_url,signature:e.signature||""})}),o.imageList=(a=o.imageList,r="secure_url",a.filter(function(e,t,a){return a.map(function(e){return e[r]}).indexOf(e[r])===t}));var t={title:n.title,message:n.message,anonymouscomment:n.anonymouscomment,notified:o.currentPost.data.notified,embed:n.embed?n.embed.replace("src=","xxx=").replace("href=","yyyy="):"",embedDescription:n.embedDescription,files:o.imageList,sharedData:n.sharedData};i.EditPost(e,t).then(function(e){"200"==e.status?(e&&e.data&&e.data._id&&s.path("/page/"+o.currentPost.data.page+"/post/"+e.data._id),o.loading=!1):(o.loading=!1,l.dataLoading=!1,s.path("/"))})}var a,r},l.detail=function(e){s.path("/detail/"+e)},n.initController=function(){a.get("/data.json").success(function(e){o.masterList=e});var e=s.path().split("/"),t=e[e.length-1];n.id=t,o.loading=!0,n.mainImage="https://placehold.it/710X420",i.GetAPostForEdit(t).then(function(e){"200"==e.status?(e.data.page?(o.currentPost.data=e.data,n.id=o.currentPost.data._id,n.title=o.currentPost.data.title,o.pageTitle=n.title,n.message=o.currentPost.data.body,n.created=o.currentPost.data.created,n.notified=o.currentPost.data.notified||"no",o.imageList=o.currentPost.data.files,n.files=o.currentPost.data.files,n.sharedData=o.currentPost.data.sharedData||{},n.imageUrl=[{}],n.files.map(function(e){"imageURL"===e.resource_type&&n.imageUrl.push(e)}),n.files=n.files.filter(function(e){return!e.resource_type}),n.anonymouscomment=o.currentPost.data.anonymouscomment||"disabled",n.share=o.currentPost.data.share||"disabled",n.embed=o.currentPost.data.embed?o.currentPost.data.embed.replace("xxx=","src=").replace("yyyy=","href="):"",n.embedDescription=o.currentPost.data.embedDescription):(o.currentPost.data=e.data,o.regionList=o.masterList[e.data.state],n.regions=o.regionList,l.state=e.data.state,l.region=e.data.region,l.category=e.data.category,n.id=o.currentPost.data._id,n.title=o.currentPost.data.title,o.pageTitle=n.title,n.message=o.currentPost.data.body,n.age=o.currentPost.data.age,n.location=o.currentPost.data.location,n.region=o.currentPost.data.region,n.country=o.currentPost.data.country,n.state=o.currentPost.data.state,n.category=o.currentPost.data.category,n.created=o.currentPost.data.created,n.files=o.currentPost.data.files,n.city=o.currentPost.data.city,n.zip=o.currentPost.data.zip,o.imageList=o.currentPost.data.files,n.newmasterList=o.masterListAll[n.country],n.newstates=Object.keys(o.masterListAll[n.country]),"United States"==n.country||"Canada"==n.country?n.newregions=n.newmasterList[n.state]:n.newregions=n.newmasterList.State,n.newregions.unshift("Region"),n.haircolor=o.currentPost.data.haircolor||"Hair Color",n.height=o.currentPost.data.height||"Height",n.ethnicity=o.currentPost.data.ethnicity||"Ethnicity",n.orientation=o.currentPost.data.orientation||"Orientation",n.bodytype=o.currentPost.data.bodytype||"Body Type",n.eyecolor=o.currentPost.data.eyecolor||"Eye Color",n.mstatus=o.currentPost.data.mstatus||"Status",n.gender=o.currentPost.data.gender||"Gender",n.bodyhair=o.currentPost.data.bodyhair||"Body Hair",n.hivstatus=o.currentPost.data.hivstatus||"HIV Status",n.weight=o.currentPost.data.weight||"Weight",n.mage=o.currentPost.data.mage||"Age",n.anonymouscomment=o.currentPost.data.anonymouscomment||"disabled",n.notified=o.currentPost.data.notified||"no",n.share=o.currentPost.data.share||"disabled",n.embed=o.currentPost.data.embed?o.currentPost.data.embed.replace("xxx=","src=").replace("yyyy=","href="):""),o.loading=!1,0<n.files.length&&(n.mainImage=n.files[0].secure_url)):(o.loading=!1,l.dataLoading=!1,s.path("/"))})}}]),app.controller("FlagController",["$rootScope","$scope","$routeParams","$location","HttpService","$http","FlashService","$window",function(r,o,e,n,s,t,i,c){var l=this;o.pageId=e.pageId,r.pageTitle="Healthy Fling",o.states=r.stateList,o.regions=r.regionList,o.regions&&-1==o.regions.indexOf("Region")&&o.regions.unshift("Region"),o.categories=r.categoryList,o.selection=[],o.toggleSelection=function(e,t){var a=t.indexOf(e);-1<a?t.splice(a,1):t.push(e)},o.changeListInCtrl=function(e){if(""!=e&&null!=e&&"State"!=e&&"Provinces"!=e){r.regionList=r.masterList[e],o.regions=r.regionList,o.regions.unshift("Region");var a=o.regions;o.regions=a.filter(function(e,t){return a.indexOf(e)==t})}else"United States"!=l.country&&"Canada"!=l.country||(o.regions=["Region"])},o.changeStateListInCtrl=function(e){if(""!=e&&null!=e&&"Country"!=e)if(r.masterList=r.masterListAll[e],r.stateList=Object.keys(r.masterListAll[e]),o.states=r.stateList,"United States"!=e&&"Canada"!=e){r.regionList=r.masterList.State,o.regions=r.regionList,o.regions.unshift("Region");var a=o.regions;o.regions=a.filter(function(e,t){return a.indexOf(e)==t})}else"Canada"==e&&(l.state="Provinces")},o.updateList=function(e){r.regionList=r.masterList[e],o.regions=r.regionList,o.regions.unshift("Region")},l.post=function(){n.path("/post")},l.pages=function(){l.dataLoading=!0,n.path("/pages")},l.login=function(){r.modalInstance=$modal.open({templateUrl:"app-view/login/LoginView.html"})},l.logout=function(){l.dataLoading=!0,c.localStorage.removeItem("token"),n.path("/"),window.location.reload()},l.search=function(){r.search.state=this.state,r.search.region=this.region,r.search.category=this.category,n.path("/search")},l.post=function(){l.dataLoading=!0,n.path("/post")},l.search=function(){l.dataLoading=!0,n.path("/search")},o.initController=function(){t.get("/data.json").success(function(e){r.masterList=e})},o.flagPost=function(){o.showError=!0,o.showReasonError=!1,o.selection.length<1&&(o.showReasonError=!0);var e=n.path().split("/"),t=e[e.length-1];if(o.id=t,r.loading=!0,o.mainImage="https://placehold.it/710X420",o.showReasonError)c.scrollTo(0,0);else{o.showError=!1,o.closeModal();var a={flagreason:o.selection};s.FlagPostReason(t,a).then(function(e){"200"==e.status?(e&&e.data&&e.data._id&&(i.Success("The post is flagged for review."),r.is_flagged=!0),r.loading=!1):(r.loading=!1,i.Error("There was an error while submitting your request. Please try again."),l.dataLoading=!1)})}},o.notify=function(){if(o.captcha)if(o.email){r.loading=!0;var e={htmlmessage:"<p>"+o.replymessage+"</p><p>"+n.absUrl().replace("reply","detail")+"</p><p><a href='mailto:"+o.email+"?subject=Re: "+o.title+"'>Reply to this message</a> </p> Regards, <br/>Healthyfling Team",subject:"Re: "+(o.title||o.message),sender1:o.sender1};s.SendMail(e).then(function(e){"200"==e.success||"250"==e.success?(r.loading=!1,alert("Email has been sent to the poster!")):(l.dataLoading=!1,r.loading=!1,alert("Email has been sent to the poster!"),n.path("/"))})}else alert("Email address is missing");else alert("Please accept the terms and condition.")},o.closeModal=function(){r.modalInstance.close()}}]),app.controller("OptionsController",["$rootScope","$scope","$location","HttpService","$http","FlashService","$window","$route",function(r,o,n,s,e,i,c,a){var l=this;r.pageTitle="Healthy Fling",o.states=r.stateList,o.regions=r.regionList,o.regions&&-1==o.regions.indexOf("Region")&&o.regions.unshift("Region"),o.categories=r.categoryList,o.selection=[],o.toggleSelection=function(e,t){var a=t.indexOf(e);-1<a?t.splice(a,1):t.push(e)},o.changeListInCtrl=function(e){if(""!=e&&null!=e&&"State"!=e&&"Provinces"!=e){r.regionList=r.masterList[e],o.regions=r.regionList,o.regions.unshift("Region");var a=o.regions;o.regions=a.filter(function(e,t){return a.indexOf(e)==t})}else"United States"!=l.country&&"Canada"!=l.country||(o.regions=["Region"])},o.changeStateListInCtrl=function(e){if(""!=e&&null!=e&&"Country"!=e)if(r.masterList=r.masterListAll[e],r.stateList=Object.keys(r.masterListAll[e]),o.states=r.stateList,"United States"!=e&&"Canada"!=e){r.regionList=r.masterList.State,o.regions=r.regionList,o.regions.unshift("Region");var a=o.regions;o.regions=a.filter(function(e,t){return a.indexOf(e)==t})}else"Canada"==e&&(l.state="Provinces")},o.updateList=function(e){r.regionList=r.masterList[e],o.regions=r.regionList,o.regions.unshift("Region")},l.post=function(){n.path("/post")},l.pages=function(){l.dataLoading=!0,n.path("/pages")},l.login=function(){r.modalInstance=$modal.open({templateUrl:"app-view/login/LoginView.html"})},l.logout=function(){l.dataLoading=!0,c.localStorage.removeItem("token"),n.path("/"),window.location.reload()},l.search=function(){r.search.state=this.state,r.search.region=this.region,r.search.category=this.category,n.path("/search")},l.post=function(){l.dataLoading=!0,n.path("/post")},l.search=function(){l.dataLoading=!0,n.path("/search")},o.initController=function(){e.get("/data.json").success(function(e){r.masterList=e})},o.flagComment=function(){o.showError=!0,o.showReasonError=!1,o.selection.length<1&&(o.showReasonError=!0);var e=r.comment_to_flag._id;if(r.loading=!0,o.showReasonError)c.scrollTo(0,0);else{o.showError=!1,o.closeModal();var t={flagreason:o.selection};s.FlagACommentReason(e,t).then(function(e){"200"==e.status?(i.Success("The comment has been successfully flagged."),r.loading=!1,r.comment_to_flag={},c.scrollTo(0,0),a.reload()):r.loading=!1})}},o.flagReply=function(){o.showError=!0,o.showReasonError=!1,o.selection.length<1&&(o.showReasonError=!0);var e=r.reply_to_flag._id;if(r.loading=!0,o.showReasonError)c.scrollTo(0,0);else{o.showError=!1,o.closeModal();var t={flagreason:o.selection};s.FlagAReply(e,t).then(function(e){"200"==e.status?(i.Success("The comment has been successfully flagged."),r.loading=!1,r.reply_to_flag={},c.scrollTo(0,0),a.reload()):r.loading=!1})}},o.flagPost=function(){o.showError=!0,o.showReasonError=!1,o.selection.length<1&&(o.showReasonError=!0);var e=n.path().split("/"),t=e[e.length-1];if(o.id=t,r.loading=!0,o.mainImage="https://placehold.it/710X420",o.showReasonError)c.scrollTo(0,0);else{o.showError=!1,o.closeModal();var a={flagreason:o.selection};s.FlagPostReason(t,a).then(function(e){"200"==e.status?(e&&e.data&&e.data._id&&(i.Success("An email has been sent to the poster saying that the post is flagged and will be removed from healthyflings listing."),r.is_flagged=!0),r.loading=!1):(r.loading=!1,i.Error("There was an error while submitting your request. Please try again."),l.dataLoading=!1)})}},o.notify=function(){if(o.captcha)if(o.email){r.loading=!0;var e={htmlmessage:"<p>"+o.replymessage+"</p><p>"+n.absUrl().replace("reply","detail")+"</p><p><a href='mailto:"+o.email+"?subject=Re: "+o.title+"'>Reply to this message</a> </p> Regards, <br/>Healthyfling Team",subject:"Re: "+(o.title||o.message),sender1:o.sender1};s.SendMail(e).then(function(e){"200"==e.success||"250"==e.success?(r.loading=!1,alert("Email has been sent to the poster!")):(l.dataLoading=!1,r.loading=!1,alert("Email has been sent to the poster!"),n.path("/"))})}else alert("Email address is missing");else alert("Please accept the terms and condition.")},o.closeModal=function(){r.modalInstance.close()}}]),app.controller("DetailController",["$rootScope","$scope","$location","HttpService","$http","$route","FlashService","$document","$modal","$window","$routeParams","MetaService",function(o,i,n,a,r,e,s,t,c,l,g,d){var h=this;o.visitedSearchPage&&(o.loading=!0),n.search().success&&s.Success("Your post is live now!"),i.replyNotified=!1,i.showShareButtons=!1,i.showEmbedButtons=!1,i.replyNotifiedEmail="",i.currentPath=n.absUrl(),i.embed="",i.commentembed="",i.comments=[],i.commentsMainImage=[],i.replyMainImage=[],o.savedPreference=l.localStorage.getItem("healthyfling_preference"),"locked"==o.savedPreference&&(o.search.country=l.localStorage.getItem("healthyfling_preference_country")||"Country",o.search.state=l.localStorage.getItem("healthyfling_preference_state")||"State",o.search.region=l.localStorage.getItem("healthyfling_preference_region")||"Region",o.search.category=l.localStorage.getItem("healthyfling_preference_category")||"Category"),h.country=o.search.country||"Country",h.state=o.search.state||"State",h.region=o.search.region||"Region",h.category=o.search.category||"Category",i.countries=o.countryList,i.states=o.stateList,i.regions=o.regionList||["REGION"],i.regions&&-1==i.regions.indexOf("Region")&&i.regions.unshift("Region"),i.categories=o.categoryList,i.savedPreference="locked"==o.savedPreference,h.savedPreference="locked"==o.savedPreference,i.changeListInCtrl=function(e){if(""!=e&&null!=e&&"State"!=e&&"Provinces"!=e){o.masterList=o.masterListAll[h.country],o.regionList=o.masterList[e],i.regions=o.regionList,i.regions.unshift("Region");var a=i.regions;i.regions=a.filter(function(e,t){return a.indexOf(e)==t})}else"United States"!=h.country&&"Canada"!=h.country||(i.regions=["Region"])},i.changeStateListInCtrl=function(e){if(""!=e&&null!=e&&"Country"!=e)if(o.masterList=o.masterListAll[e],o.stateList=Object.keys(o.masterListAll[e]),i.states=o.stateList,"United States"!=e&&"Canada"!=e){o.regionList=o.masterList.State,i.regions=o.regionList,i.regions.unshift("Region");var a=i.regions;i.regions=a.filter(function(e,t){return a.indexOf(e)==t})}else"Canada"==e&&(h.state="Provinces");else o.stateList=["State"],i.states=o.stateList},h.lockPreference=function(){l.localStorage.setItem("healthyfling_preference","locked"),l.localStorage.setItem("healthyfling_preference_country",h.country),l.localStorage.setItem("healthyfling_preference_state",h.state),l.localStorage.setItem("healthyfling_preference_region",h.region),l.localStorage.setItem("healthyfling_preference_category",h.category),o.savedPreference=!0,h.savedPreference=!0,i.savedPreference="locked",s.Success("Search preference saved for easier browsing.")},h.unlockPreference=function(){l.localStorage.setItem("healthyfling_preference","unlocked"),h.country=o.search.country="Country",h.state=o.search.state="State",h.region=o.search.region="Region",h.category=o.search.category="Category",o.savedPreference=!1,h.savedPreference=!1,i.savedPreference="unlocked",s.Success("Search preference has been deleted.")},o.imageList=[],i.addComment=function(e){if(i.showError=!0,"Age"==i.mage&&(i.mage=""),null==i.commentmessage&&""==i.commentmessage||null==i.captcha)s.Error("Please select the Capcha!"),l.scrollTo(0,0);else{i.showImageError=!1,o.loading=!0;var t={commentmessage:i.commentmessage,email:i.replyNotifiedEmail,commentfiles:o.imageList,commentembed:i.commentembed.replace("src=","xxx=").replace("href=","yyyy=")};a.EditPost(e,t).then(function(e){"200"==e.status?(e&&e.data&&e.data._id&&(n.path("/detail/"+e.data._id),s.Success("Your comment has been successfully added."),i.loadComments(i.id),i.commentmessage="",i.commentembed="",l.scrollTo(0,0)),o.loading=!1,o.imageList=[],i.commentsMainImage=[],i.replyMainImage=[],i.comments=[]):(o.loading=!1,h.dataLoading=!1,n.path("/"))})}},i.replyComment=function(e){},i.changeMainImage=function(e,t,a){a?(i.city&&(i.cityURL="https://www.google.com/maps/embed/v1/place?q="+i.city+"&key=AIzaSyCS-3gM8t4h2fR3XGawtaX8TYCC4PYEwlw"),i.zip&&(i.zipURL="https://www.google.com/maps/embed/v1/place?q="+i.zip+"&key=AIzaSyCS-3gM8t4h2fR3XGawtaX8TYCC4PYEwlw"),i.showMap=!0,i.showVideo=!1):0==t?(i.showMap=!1,i.showMap=!1,i.showVideo=!1,i.mainImage=e.secure_url):(i.showVideo=!0,i.showMap=!1,-1<i.embed.indexOf("<iframe")?i.iframe=!0:(i.iframe=!1,-1<i.embed.indexOf("youtube.com")&&(i.embed="https://www.youtube.com/embed/"+i.embed.slice(i.embed.indexOf("v=")+2,i.embed.length))),i.mainImage=e)},i.changeCommentsMainImage=function(e,t){i.commentsMainImage[t]=e},i.changeReplyMainImage=function(e,t,a){i.replyMainImage[t][a]=e};var u=n.path().split("/"),m=u[u.length-1];i.id=m,i.loadComments=function(e){i.commentsMainImage=[],i.replyMainImage=[],i.comments=[];var s=[];a.GetComments(e).then(function(e){if("200"==e.status)for(var t=0;t<e.data.length;t++){var a=e.data[t];a.embed&&(a.embed=a.embed.replace("xxx=","src=").replace("yyyy=","href=")),null!=a&&0<a.files.length?a.mainImage=a.files[0].secure_url:null!=a&&""!=a.embed&&0==a.files.length&&(a.mainImage=a.embed),a.replies.reverse(),s=[];for(var r=0;r<a.replies.length;r++){if(null!=a.replies[r].label){var o=i.findIndexByKeyValue(a.replies,"_id",a.replies[r].label);if(-1<o){var n=a.replies[o].owner;a.replies[r].responseLabel="poster"==n?'(Response to "Reply '+(o+1)+' posters response")':'(Response to "Reply '+(o+1)+'")'}}null!=a.replies[r].embed&&""!=a.replies[r].embed?a.replies[r].embed=a.replies[r].embed.replace("xxx=","src=").replace("yyyy=","href="):a.replies[r].embed="",null!=a.replies[r]&&0<a.replies[r].files.length?a.replies[r].mainImage=a.replies[r].files[0].secure_url:null!=a.replies[r]&&""!=a.replies[r].embed&&0==a.replies[r].files.length&&(a.replies[r].mainImage=a.replies[r].embed),s.push(a.replies[r].mainImage)}i.replyMainImage.push(s),i.commentsMainImage.push(a.mainImage),i.comments.push(a)}})},i.findIndexByKeyValue=function(e,t,a){for(var r=0;r<e.length;r++)if(e[r][t]==a)return r;return-1},i.deleteComment=function(e){o.loading=!0,a.DeleteAComment(e).then(function(e){"200"==e.status?(i.loadComments(i.id),s.Success("The comment has been successfully deleted."),o.loading=!1,l.scrollTo(0,0)):o.loading=!1})},i.deleteReply=function(e){o.loading=!0,a.DeleteAReply(e).then(function(e){"200"==e.status?(i.loadComments(i.id),s.Success("The reply has been successfully deleted."),o.loading=!1,l.scrollTo(0,0)):o.loading=!1})},i.flagComment=function(e){o.loading=!0,a.FlagAComment(e).then(function(e){"200"==e.status?(i.loadComments(i.id),s.Success("The comment has been successfully flagged."),o.loading=!1,l.scrollTo(0,0)):o.loading=!1})},i.unflagComment=function(e){o.loading=!0,a.UnflagAComment(e).then(function(e){"200"==e.status?(i.loadComments(i.id),s.Success("The comment has been successfully unflagged."),o.loading=!1,l.scrollTo(0,0)):o.loading=!1})},i.initController=function(){r.get("/data_country.json").success(function(e){o.masterListAll=e}),o.is_flagged=!1,h.country=o.search.country,h.state=o.search.state,h.region=o.search.region,h.category=o.search.category,i.comments=[];var e=n.path().split("/"),t=e[e.length-1];i.id=t,o.visitedSearchPage&&(o.loading=!0),i.mainImage="https://www.healthyfling.com/processed/default-52adc3dc03639885e8aa93763e29868269dd3b9dad4689f140c0175b4f945922.png",a.GetAPost(t).then(function(e){if(i.is_edit=!1,"200"==e.status&&e.data._id){o.currentPost.data=e.data,o.metaservice=d,o.metaservice.set(e.data.title,e.data.body,!!(e.data.files.length&&e.data.files[0]&&e.data.files[0].secure_url)&&e.data.files[0].secure_url);var t=n.search();t&&"true"==t.success?s.Success("Your post is now Live."):t&&"true"==t.edit?i.is_edit=!0:-1<n.url().indexOf("msg=true")&&s.Success("You have successfully replied to this post, you may or may not get a response from this poster."),h.country=e.data.country||"United States",o.masterList=o.masterListAll[h.country],o.regionList=o.masterList[e.data.state],i.regions=o.regionList,h.state=e.data.state,h.region=e.data.region,h.category=e.data.category,i.title=o.currentPost.data.title,o.pageTitle=i.title,i.post_id=o.currentPost.data._id,i.message=o.currentPost.data.body,i.message=i.message.replace(/[\r\n]/g,"<br/>"),i.age=o.currentPost.data.age,i.region=o.currentPost.data.region,i.location=o.currentPost.data.location,i.sender1=o.currentPost.data.email,i.country=o.currentPost.data.country||"United States",i.state=o.currentPost.data.state,i.category=o.currentPost.data.category,i.created=o.currentPost.data.created,i.expires=new Date(o.currentPost.data.created),i.expires.setDate(i.expires.getDate()+8),i.files=o.currentPost.data.files,i.status=o.currentPost.data.status,i.haircolor=o.currentPost.data.haircolor,i.city=o.currentPost.data.city,i.zip=o.currentPost.data.zip,i.height=o.currentPost.data.height,i.ethnicity=o.currentPost.data.ethnicity,i.orientation=o.currentPost.data.orientation,i.bodytype=o.currentPost.data.bodytype,i.eyecolor=o.currentPost.data.eyecolor,i.mstatus=o.currentPost.data.mstatus,i.gender=o.currentPost.data.gender,i.bodyhair=o.currentPost.data.bodyhair,i.hivstatus=o.currentPost.data.hivstatus,i.weight=o.currentPost.data.weight,i.mage=o.currentPost.data.mage,i.anonymouscomment=o.currentPost.data.anonymouscomment||"disabled",i.embed=o.currentPost.data.embed?o.currentPost.data.embed.replace("xxx=","src=").replace("yyyy=","href="):"",i.share=o.currentPost.data.share||"disabled",o.loading=!1,0<i.files.length?i.mainImage=i.files[0].secure_url:""!=i.embed&&0==i.files.length&&(i.mainImage=i.embed),i.files.length||i.embed||!i.zip&&!i.city||(i.city&&(i.cityURL="https://www.google.com/maps/embed/v1/place?q="+i.city+"&key=AIzaSyCS-3gM8t4h2fR3XGawtaX8TYCC4PYEwlw"),i.zip&&(i.zipURL="https://www.google.com/maps/embed/v1/place?q="+i.zip+"&key=AIzaSyCS-3gM8t4h2fR3XGawtaX8TYCC4PYEwlw"),i.showMap=!0,i.showVideo=!1),i.files.length||!i.embed||i.zip&&i.city||(i.showVideo=!0,i.showMap=!1,-1<i.embed.indexOf("<iframe")?i.iframe=!0:(i.iframe=!1,-1<i.embed.indexOf("youtube.com")&&(i.embed="https://www.youtube.com/embed/"+i.embed.slice(i.embed.indexOf("v=")+2,i.embed.length))))}else o.loading=!1,h.dataLoading=!1,n.path("/expired")}),i.loadComments(t)},o.reloadPost=function(){h.state=o.currentPost.data.body},h.post=function(){n.path("/post")},h.pages=function(){h.dataLoading=!0,n.path("/pages")},h.login=function(){o.modalInstance=c.open({templateUrl:"app-view/login/LoginView.html"})},h.logout=function(){h.dataLoading=!0,l.localStorage.removeItem("token"),n.path("/"),window.location.reload()},h.search=function(){o.loading=!0,o.search.country=this.country,o.search.state=this.state,o.search.region=this.region,o.search.category=this.category,n.path("/search")},h.searchFilter=function(e,t,a,r){"Country"==e&&"State"==t&&"Region"==a||(o.loading=!0,o.search.country=e,o.search.state=t,o.search.region=a,o.search.category=r,n.path("/search"))},i.notify=function(){if(i.showEmail=!0,i.showEmail&&i.sender2&&0<i.sender2.length){o.loading=!0;var e={message:"Perfect match found for both of you.",subject:"We need to put in a subject",sender1:i.sender1,sender2:i.sender2,link:n.$$absUrl};a.SendMail(e).then(function(e){"200"==e.success||"250"==e.success?(o.loading=!1,alert("Email has been sent to the poster!")):(h.dataLoading=!1,o.loading=!1,alert("Email has been sent to the poster!"),n.path("/"))})}},i.toggleReplyNotify=function(){i.replyNotified&&1==i.replyNotified?(i.replyNotified=!1,i.replyNotifiedEmail=""):i.replyNotified=!0},i.toggleEmbedButton=function(){i.showEmbedButtons&&1==i.showEmbedButtons?i.showEmbedButtons=!1:i.showEmbedButtons=!0},i.toggleShareButton=function(){i.showShareButtons&&1==i.showShareButtons?i.showShareButtons=!1:i.showShareButtons=!0},i.openModal=function(){o.modalInstance=c.open({templateUrl:"app-view/reply/ReplyView.html"})},i.openModal_flag=function(){o.modalInstance=c.open({templateUrl:"app-view/flag/FlagView.html"})},i.openModal_subscribe=function(){o.modalInstance=c.open({templateUrl:"app-view/subscribe/SubscribeView.html"})},i.openCommentModal=function(e,t){o.comment=e,o.comment.replyLabel=t._id,"poster"==t.owner&&"yes"==o.currentPost.data.notified?o.comment.replyEmail=o.currentPost.data.email||"":o.comment.replyEmail=t.email||"",o.comment.ownerEmail=o.currentPost.data.email,o.modalInstance=c.open({templateUrl:"app-view/comment/CommentView.html"})},i.openCommentModalPoster=function(e,t){o.comment=e,o.comment.replyLabel=t._id,o.comment.replyEmail=t.email||"",o.comment.ownerEmail=o.currentPost.data.email,o.comment.owner="poster",o.modalInstance=c.open({templateUrl:"app-view/comment/CommentView.html"})},i.openCommentsModal_flag=function(e){o.comment_to_flag=e,o.modalInstance=c.open({templateUrl:"app-view/options/OptionsView.html"})},i.openReplyModal_flag=function(e){o.reply_to_flag=e,o.modalInstance=c.open({templateUrl:"app-view/options/OptionsView.html"})},i.unflagReply=function(e){o.loading=!0,a.UnflagAReply(e).then(function(e){"200"==e.status?(i.loadComments(i.id),s.Success("The comment has been successfully unflagged."),o.loading=!1,l.scrollTo(0,0)):o.loading=!1})},i.$on("reloadComments",function(){i.loadComments(i.id)}),i.deleteImage=function(e){o.imageList.splice(e,1),i.files=o.imageList},i.stopLoader=function(){o.loadingImage=!1},i.delete=function(){o.modalInstance=c.open({templateUrl:"app-view/detail/DeleteModal.html"})},i.closeModal=function(){o.modalInstance.close()},i.deletePost=function(){o.modalInstance.close(),n.path("/delete/"+g.id)}}]),app.controller("PagePostDetailController",["$rootScope","$scope","$location","HttpService","$http","$route","FlashService","$document","$modal","$window","$routeParams","MetaService",function(o,i,n,a,r,e,s,t,c,l,g,d){var h=this;o.visitedSearchPage&&(o.loading=!0),n.search().success&&s.Success("Your post is live now!"),i.react=function(t,e){if(!o.isLoggedIn)return alert("You need to be logged in!");window.localStorage.getItem(e+"1")||(window.localStorage.setItem(e+"1",!0),a.ReactPost(e,t).then(function(e){i.currentPost.data.reactions[t]=i.currentPost.data.reactions[t]+1}))},i.likePost=function(e){if(!o.isLoggedIn)return alert("You need to be logged in!");window.localStorage.getItem(e)||(window.localStorage.setItem(e,!0),a.LikePost(e).then(function(e){i.currentPost.data.like=i.currentPost.data.like+1}))},i.dislikePost=function(e){if(!o.isLoggedIn)return alert("You need to be logged in!");window.localStorage.getItem(e)||(window.localStorage.setItem(e,!0),a.DislikePost(e).then(function(e){i.currentPost.data.dislike=i.currentPost.data.dislike+1}))},i.likeComment=function(e,t){if(!o.isLoggedIn)return alert("You need to be logged in!");window.localStorage.getItem(e)||(window.localStorage.setItem(e,!0),a.LikeComment(e,t).then(function(e){i.loadComments(g.postId)}))},i.dislikeComment=function(e,t){if(!o.isLoggedIn)return alert("You need to be logged in!");window.localStorage.getItem(e)||(window.localStorage.setItem(e,!0),a.DislikeComment(e,t).then(function(e){i.loadComments(g.postId)}))},i.replyNotified=!1,i.showShareButtons=!1,i.showEmbedButtons=!1,i.replyNotifiedEmail="",i.embed="",i.commentembed="",i.comments=[],i.commentsMainImage=[],i.replyMainImage=[],o.savedPreference=l.localStorage.getItem("healthyfling_preference"),"locked"==o.savedPreference&&(o.search.country=l.localStorage.getItem("healthyfling_preference_country")||"Country",o.search.state=l.localStorage.getItem("healthyfling_preference_state")||"State",o.search.region=l.localStorage.getItem("healthyfling_preference_region")||"Region",o.search.category=l.localStorage.getItem("healthyfling_preference_category")||"Category"),h.country=o.search.country||"Country",h.state=o.search.state||"State",h.region=o.search.region||"Region",h.category=o.search.category||"Category",i.countries=o.countryList,i.states=o.stateList,i.regions=o.regionList||["REGION"],i.regions&&-1==i.regions.indexOf("Region")&&i.regions.unshift("Region"),i.categories=o.categoryList,i.savedPreference="locked"==o.savedPreference,h.savedPreference="locked"==o.savedPreference,i.changeListInCtrl=function(e){if(""!=e&&null!=e&&"State"!=e&&"Provinces"!=e){o.masterList=o.masterListAll[h.country],o.regionList=o.masterList[e],i.regions=o.regionList,i.regions.unshift("Region");var a=i.regions;i.regions=a.filter(function(e,t){return a.indexOf(e)==t})}else"United States"!=h.country&&"Canada"!=h.country||(i.regions=["Region"])},i.changeStateListInCtrl=function(e){if(""!=e&&null!=e&&"Country"!=e)if(o.masterList=o.masterListAll[e],o.stateList=Object.keys(o.masterListAll[e]),i.states=o.stateList,"United States"!=e&&"Canada"!=e){o.regionList=o.masterList.State,i.regions=o.regionList,i.regions.unshift("Region");var a=i.regions;i.regions=a.filter(function(e,t){return a.indexOf(e)==t})}else"Canada"==e&&(h.state="Provinces");else o.stateList=["State"],i.states=o.stateList},h.lockPreference=function(){l.localStorage.setItem("healthyfling_preference","locked"),l.localStorage.setItem("healthyfling_preference_country",h.country),l.localStorage.setItem("healthyfling_preference_state",h.state),l.localStorage.setItem("healthyfling_preference_region",h.region),l.localStorage.setItem("healthyfling_preference_category",h.category),o.savedPreference=!0,h.savedPreference=!0,i.savedPreference="locked",s.Success("Search preference saved for easier browsing.")},h.unlockPreference=function(){l.localStorage.setItem("healthyfling_preference","unlocked"),h.country=o.search.country="Country",h.state=o.search.state="State",h.region=o.search.region="Region",h.category=o.search.category="Category",o.savedPreference=!1,h.savedPreference=!1,i.savedPreference="unlocked",s.Success("Search preference has been deleted.")},o.imageList=[],i.addComment=function(e){if(!o.isLoggedIn)return alert("You need to be logged in!");if(i.showError=!0,"Age"==i.mage&&(i.mage=""),null==i.commentmessage&&""==i.commentmessage||null==i.captcha)s.Error("Please select the Capcha!"),l.scrollTo(0,0);else{i.showImageError=!1,o.loading=!0;var t={commentmessage:i.commentmessage,email:i.replyNotifiedEmail,commentfiles:o.imageList,commentembed:i.commentembed.replace("src=","xxx=").replace("href=","yyyy=")};a.EditPost(e,t).then(function(e){"200"==e.status?(e&&e.data&&e.data._id&&(s.Success("Your comment has been successfully added."),i.loadComments(g.postId),i.commentmessage="",i.commentembed="",l.scrollTo(0,0)),o.loading=!1,o.imageList=[],i.commentsMainImage=[],i.replyMainImage=[],i.comments=[]):(o.loading=!1,h.dataLoading=!1,n.path("/"))})}},i.changeMainImage=function(e,t,a){a?(i.city&&(i.cityURL="https://www.google.com/maps/embed/v1/place?q="+i.city+"&key=AIzaSyCS-3gM8t4h2fR3XGawtaX8TYCC4PYEwlw"),i.zip&&(i.zipURL="https://www.google.com/maps/embed/v1/place?q="+i.zip+"&key=AIzaSyCS-3gM8t4h2fR3XGawtaX8TYCC4PYEwlw"),i.showMap=!0,i.showVideo=!1):(0==t?(i.showMap=!1,i.showMap=!1,i.showVideo=!1):(i.showVideo=!0,i.showMap=!1,-1<i.embed.indexOf("<iframe")?i.iframe=!0:(i.iframe=!1,-1<i.embed.indexOf("youtube.com")&&(i.embed="https://www.youtube.com/embed/"+i.embed.slice(i.embed.indexOf("v=")+2,i.embed.length)))),i.mainImage=e)},i.changeCommentsMainImage=function(e,t){i.commentsMainImage[t]=e},i.changeReplyMainImage=function(e,t,a){i.replyMainImage[t][a]=e};var u=n.path().split("/"),m=u[u.length-1];i.id=m,i.currentPath=n.absUrl(),i.toggleShareButton=function(){i.showShareButtons&&1==i.showShareButtons?i.showShareButtons=!1:i.showShareButtons=!0},i.loadComments=function(e){i.commentsMainImage=[],i.replyMainImage=[],i.comments=[];var s=[];a.GetComments(e).then(function(e){if("200"==e.status)for(var t=0;t<e.data.length;t++){var a=e.data[t];a.embed&&(a.embed=a.embed.replace("xxx=","src=").replace("yyyy=","href=")),null!=a&&0<a.files.length?a.mainImage=a.files[0].secure_url:null!=a&&""!=a.embed&&0==a.files.length&&(a.mainImage=a.embed),a.replies.reverse(),s=[];for(var r=0;r<a.replies.length;r++){if(null!=a.replies[r].label){var o=i.findIndexByKeyValue(a.replies,"_id",a.replies[r].label);if(-1<o){var n=a.replies[o].owner;a.replies[r].responseLabel="poster"==n?'(Response to "Reply '+(o+1)+' posters response")':'(Response to "Reply '+(o+1)+'")'}}null!=a.replies[r].embed&&""!=a.replies[r].embed?a.replies[r].embed=a.replies[r].embed.replace("xxx=","src=").replace("yyyy=","href="):a.replies[r].embed="",null!=a.replies[r]&&0<a.replies[r].files.length?a.replies[r].mainImage=a.replies[r].files[0].secure_url:null!=a.replies[r]&&""!=a.replies[r].embed&&0==a.replies[r].files.length&&(a.replies[r].mainImage=a.replies[r].embed),s.push(a.replies[r].mainImage)}i.replyMainImage.push(s),i.commentsMainImage.push(a.mainImage),i.comments.push(a)}})},i.findIndexByKeyValue=function(e,t,a){for(var r=0;r<e.length;r++)if(e[r][t]==a)return r;return-1},i.deleteComment=function(e){o.loading=!0,a.DeleteAComment(e).then(function(e){"200"==e.status?(i.loadComments(i.id),s.Success("The comment has been successfully deleted."),o.loading=!1,l.scrollTo(0,0)):o.loading=!1})},i.deleteReply=function(e){o.loading=!0,a.DeleteAReply(e).then(function(e){"200"==e.status?(i.loadComments(i.id),s.Success("The reply has been successfully deleted."),o.loading=!1,l.scrollTo(0,0)):o.loading=!1})},i.flagComment=function(e){o.loading=!0,a.FlagAComment(e).then(function(e){"200"==e.status?(i.loadComments(i.id),s.Success("The comment has been successfully flagged."),o.loading=!1,l.scrollTo(0,0)):o.loading=!1})},i.unflagComment=function(e){o.loading=!0,a.UnflagAComment(e).then(function(e){"200"==e.status?(i.loadComments(i.id),s.Success("The comment has been successfully unflagged."),o.loading=!1,l.scrollTo(0,0)):o.loading=!1})},i.initController=function(){r.get("/data_country.json").success(function(e){o.masterListAll=e}),h.country=o.search.country,h.state=o.search.state,h.region=o.search.region,h.category=o.search.category,i.comments=[];var e=n.path().split("/"),t=e[e.length-1];i.id=t,o.visitedSearchPage&&(o.loading=!0),i.mainImage={secure_url:"https://www.healthyfling.com/processed/default-52adc3dc03639885e8aa93763e29868269dd3b9dad4689f140c0175b4f945922.png"},a.GetAPagePost(g.pageId,g.postId).then(function(e){if("200"==e.status&&e.data._id){o.currentPost.data=e.data,e.data&&e.data.isOwner&&(i.owner=!0),o.metaservice=d,o.metaservice.set(e.data.title,e.data.body,!!(e.data.files.length&&e.data.files[0]&&e.data.files[0].secure_url)&&e.data.files[0].secure_url);var t=n.search();t&&"true"==t.success?s.Success("Your post is now Live."):-1<n.url().indexOf("msg=true")&&s.Success("You have successfully replied to this post, you may or may not get a response from this poster."),h.country=e.data.country||"United States",o.masterList=o.masterListAll[h.country],o.regionList=o.masterList[e.data.state],i.regions=o.regionList,h.state=e.data.state,h.region=e.data.region,h.category=e.data.category,i.title=o.currentPost.data.title,o.pageTitle=i.title,i.post_id=o.currentPost.data._id,i.message=o.currentPost.data.body,i.message=i.message.replace(/[\r\n]/g,"<br/>"),i.age=o.currentPost.data.age,i.region=o.currentPost.data.region,i.location=o.currentPost.data.location,i.sender1=o.currentPost.data.email,i.country=o.currentPost.data.country||"United States",i.state=o.currentPost.data.state,i.category=o.currentPost.data.category,i.created=o.currentPost.data.created,i.expires=new Date(o.currentPost.data.created),i.expires.setDate(i.expires.getDate()+8),i.files=o.currentPost.data.files,i.status=o.currentPost.data.status,i.haircolor=o.currentPost.data.haircolor,i.city=o.currentPost.data.city,i.zip=o.currentPost.data.zip,i.height=o.currentPost.data.height,i.ethnicity=o.currentPost.data.ethnicity,i.orientation=o.currentPost.data.orientation,i.bodytype=o.currentPost.data.bodytype,i.eyecolor=o.currentPost.data.eyecolor,i.mstatus=o.currentPost.data.mstatus,i.gender=o.currentPost.data.gender,i.bodyhair=o.currentPost.data.bodyhair,i.hivstatus=o.currentPost.data.hivstatus,i.weight=o.currentPost.data.weight,i.mage=o.currentPost.data.mage,i.anonymouscomment=o.currentPost.data.anonymouscomment||"disabled",i.embed=o.currentPost.data.embed?o.currentPost.data.embed.replace("xxx=","src=").replace("yyyy=","href="):"",i.embedDescription=o.currentPost.data.embedDescription||"",i.share=o.currentPost.data.share||"disabled",o.loading=!1,0<i.files.length?i.mainImage=i.files[0]:""!=i.embed&&0==i.files.length&&(i.mainImage=i.embed),i.files.length||i.embed||!i.zip&&!i.city||(i.city&&(i.cityURL="https://www.google.com/maps/embed/v1/place?q="+i.city+"&key=AIzaSyCS-3gM8t4h2fR3XGawtaX8TYCC4PYEwlw"),i.zip&&(i.zipURL="https://www.google.com/maps/embed/v1/place?q="+i.zip+"&key=AIzaSyCS-3gM8t4h2fR3XGawtaX8TYCC4PYEwlw"),i.showMap=!0,i.showVideo=!1),i.files.length||!i.embed||i.zip&&i.city||(i.showVideo=!0,i.showMap=!1,-1<i.embed.indexOf("<iframe")?i.iframe=!0:(i.iframe=!1,-1<i.embed.indexOf("youtube.com")&&(i.embed="https://www.youtube.com/embed/"+i.embed.slice(i.embed.indexOf("v=")+2,i.embed.length))))}else o.loading=!1,h.dataLoading=!1,n.path("/expired")}),i.loadComments(t)},o.reloadPost=function(){h.state=o.currentPost.data.body},h.post=function(){n.path("/post")},h.pages=function(){h.dataLoading=!0,n.path("/pages")},h.login=function(){o.modalInstance=c.open({templateUrl:"app-view/login/LoginView.html"})},h.logout=function(){h.dataLoading=!0,l.localStorage.removeItem("token"),n.path("/"),window.location.reload()},h.search=function(){o.loading=!0,o.search.country=this.country,o.search.state=this.state,o.search.region=this.region,o.search.category=this.category,n.path("/search")},h.searchFilter=function(e,t,a,r){"Country"==e&&"State"==t&&"Region"==a||(o.loading=!0,o.search.country=e,o.search.state=t,o.search.region=a,o.search.category=r,n.path("/search"))},i.notify=function(){if(i.showEmail=!0,i.showEmail&&i.sender2&&0<i.sender2.length){o.loading=!0;var e={message:"Perfect match found for both of you.",subject:"We need to put in a subject",sender1:i.sender1,sender2:i.sender2,link:n.$$absUrl};a.SendMail(e).then(function(e){"200"==e.success||"250"==e.success?(o.loading=!1,alert("Email has been sent to the poster!")):(h.dataLoading=!1,o.loading=!1,alert("Email has been sent to the poster!"),n.path("/"))})}},i.toggleReplyNotify=function(){i.replyNotified&&1==i.replyNotified?(i.replyNotified=!1,i.replyNotifiedEmail=""):i.replyNotified=!0},i.toggleEmbedButton=function(){i.showEmbedButtons&&1==i.showEmbedButtons?i.showEmbedButtons=!1:i.showEmbedButtons=!0},i.toggleShareButton=function(){i.showShareButtons&&1==i.showShareButtons?i.showShareButtons=!1:i.showShareButtons=!0},i.openModal=function(){o.modalInstance=c.open({templateUrl:"app-view/reply/ReplyView.html"})},i.openModal_flag=function(){o.modalInstance=c.open({templateUrl:"app-view/flag/FlagView.html"})},i.openModal_subscribe=function(){o.modalInstance=c.open({templateUrl:"app-view/subscribe/SubscribeView.html"})},i.openCommentModal=function(e,t){o.comment=e,o.comment.replyLabel=t._id,"poster"==t.owner&&"yes"==o.currentPost.data.notified?o.comment.replyEmail=o.currentPost.data.email||"":o.comment.replyEmail=t.email||"",o.comment.ownerEmail=o.currentPost.data.email,o.modalInstance=c.open({templateUrl:"app-view/comment/CommentView.html"})},i.openCommentModalPoster=function(e,t){o.comment=e,o.comment.replyLabel=t._id,o.comment.replyEmail=t.email||"",o.comment.ownerEmail=o.currentPost.data.email,o.comment.owner="poster",o.modalInstance=c.open({templateUrl:"app-view/comment/CommentView.html"})},i.openCommentsModal_flag=function(e){o.comment_to_flag=e,o.modalInstance=c.open({templateUrl:"app-view/options/OptionsView.html"})},i.openReplyModal_flag=function(e){o.reply_to_flag=e,o.modalInstance=c.open({templateUrl:"app-view/options/OptionsView.html"})},i.unflagReply=function(e){o.loading=!0,a.UnflagAReply(e).then(function(e){"200"==e.status?(i.loadComments(i.id),s.Success("The comment has been successfully unflagged."),o.loading=!1,l.scrollTo(0,0)):o.loading=!1})},i.$on("reloadComments",function(){i.loadComments(i.id)}),i.deleteImage=function(e){o.imageList.splice(e,1),i.files=o.imageList},i.stopLoader=function(){o.loadingImage=!1},i.delete=function(){o.modalInstance=c.open({templateUrl:"app-view/pagePostDetail/DeleteModal.html"})},i.closeModal=function(){o.modalInstance.close()},i.deletePost=function(){o.modalInstance.close(),n.path("/delete/"+g.postId)}}]);